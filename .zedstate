{"split":"2-0","session.current":["/model_checking.py","/modeling.py"],"session.open":{"/modeling.py":{"scrollTop":6733,"scrollLeft":0,"selection":{"start":{"row":346,"column":6},"end":{"row":346,"column":19}},"lastUse":1542992152412,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":350,"column":61},"end":{"row":350,"column":62}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":350,"column":70},"end":{"row":350,"column":71}},"text":"k"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":350,"column":70},"end":{"row":350,"column":71}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":353,"column":40},"end":{"row":353,"column":41}},"text":"*"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":353,"column":39},"end":{"row":353,"column":40}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":41},"end":{"row":353,"column":42}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":44},"end":{"row":353,"column":45}},"text":"G"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":45},"end":{"row":353,"column":46}},"text":"("}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":46},"end":{"row":353,"column":47}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":46},"end":{"row":353,"column":47}},"text":"c"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":47},"end":{"row":353,"column":48}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":48},"end":{"row":353,"column":49}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":49},"end":{"row":353,"column":50}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":50},"end":{"row":353,"column":51}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":353,"column":49},"end":{"row":353,"column":50}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":49},"end":{"row":353,"column":50}},"text":"x"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":353,"column":50},"end":{"row":353,"column":51}},"text":"="}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":353,"column":49},"end":{"row":353,"column":50}},"text":"x"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":49},"end":{"row":353,"column":50}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":50},"end":{"row":353,"column":51}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":51},"end":{"row":353,"column":52}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":52},"end":{"row":353,"column":53}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":53},"end":{"row":353,"column":54}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":54},"end":{"row":353,"column":55}},"text":"'"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":55},"end":{"row":353,"column":56}},"text":"'"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":55},"end":{"row":353,"column":56}},"text":"u"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":56},"end":{"row":353,"column":57}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":57},"end":{"row":353,"column":58}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":58},"end":{"row":353,"column":59}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":59},"end":{"row":353,"column":60}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":62},"end":{"row":353,"column":63}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":63},"end":{"row":353,"column":82}},"text":"c_times_ro__power_c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":353,"column":82},"end":{"row":353,"column":84}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":353,"column":28},"end":{"row":353,"column":29}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":352,"column":0},"end":{"row":353,"column":0}},"nl":"\n","lines":["      "]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":66,"column":3},"end":{"row":66,"column":4}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":21},"end":{"row":68,"column":22}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":367,"column":36},"end":{"row":367,"column":37}},"text":"("}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":367,"column":35},"end":{"row":367,"column":36}},"text":"t"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":367,"column":34},"end":{"row":367,"column":35}},"text":"n"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":367,"column":33},"end":{"row":367,"column":34}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":367,"column":44},"end":{"row":367,"column":45}},"text":")"}]}]],"redo":[]},"/run.sh":{"scrollTop":30,"scrollLeft":0,"selection":{"start":{"row":19,"column":29},"end":{"row":19,"column":29}},"lastUse":1542992089690,"undo":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":8,"column":8},"end":{"row":8,"column":18}},"text":"learn_wmpi"},{"action":"insertText","range":{"start":{"row":8,"column":8},"end":{"row":8,"column":22}},"text":"model_checking"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":0},"end":{"row":10,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":20,"column":2},"end":{"row":21,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":21,"column":0},"end":{"row":22,"column":0}},"nl":"\n","lines":["  "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":23,"column":2},"end":{"row":23,"column":4}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":11,"column":0},"end":{"row":11,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":12,"column":0},"end":{"row":12,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":13,"column":0},"end":{"row":13,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":14,"column":0},"end":{"row":14,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":15,"column":0},"end":{"row":15,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":16,"column":0},"end":{"row":16,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":17,"column":0},"end":{"row":17,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":19,"column":0},"end":{"row":19,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":20,"column":0},"end":{"row":20,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":2}},"text":"  "},{"action":"removeText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":36},"end":{"row":17,"column":38}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":36},"end":{"row":17,"column":37}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":10},"end":{"row":9,"column":11}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":15},"end":{"row":16,"column":16}},"text":"4"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":14},"end":{"row":16,"column":15}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":14},"end":{"row":16,"column":15}},"text":"8"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":36},"end":{"row":16,"column":37}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":19,"column":21},"end":{"row":19,"column":26}},"text":"slurm"},{"action":"insertText","range":{"start":{"row":19,"column":21},"end":{"row":19,"column":22}},"text":"$"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":22},"end":{"row":19,"column":26}},"text":"FILE"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":25,"column":4},"end":{"row":25,"column":6}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":25,"column":12},"end":{"row":25,"column":13}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":25,"column":12},"end":{"row":25,"column":13}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":25,"column":12},"end":{"row":25,"column":13}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":25,"column":13},"end":{"row":25,"column":14}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":25,"column":14},"end":{"row":25,"column":15}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":25,"column":15},"end":{"row":25,"column":16}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":20},"end":{"row":19,"column":21}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":21},"end":{"row":19,"column":22}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":22},"end":{"row":19,"column":23}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":23},"end":{"row":19,"column":24}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":22},"end":{"row":8,"column":23}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":23},"end":{"row":8,"column":24}},"text":"w"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":24},"end":{"row":8,"column":25}},"text":"m"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":25},"end":{"row":8,"column":26}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":26},"end":{"row":8,"column":27}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":10},"end":{"row":9,"column":11}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":10},"end":{"row":9,"column":11}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":10},"end":{"row":9,"column":11}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":25,"column":4},"end":{"row":25,"column":6}},"text":"# "}]}]],"redo":[]},"/model_checking.py":{"scrollTop":4145,"scrollLeft":0,"selection":{"start":{"row":227,"column":22},"end":{"row":227,"column":22}},"lastUse":1542991994145,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":18},"end":{"row":295,"column":19}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":295,"column":18},"end":{"row":295,"column":19}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":18},"end":{"row":295,"column":19}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":19},"end":{"row":295,"column":20}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":20},"end":{"row":295,"column":26}},"text":"sim_EW"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":295,"column":24},"end":{"row":295,"column":26}},"text":"EW"},{"action":"insertText","range":{"start":{"row":295,"column":24},"end":{"row":295,"column":25}},"text":"P"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":25},"end":{"row":295,"column":26}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":26},"end":{"row":295,"column":27}},"text":"q"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":27},"end":{"row":295,"column":28}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":28},"end":{"row":295,"column":29}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":29},"end":{"row":295,"column":30}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":46},"end":{"row":295,"column":47}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":47},"end":{"row":295,"column":48}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":295,"column":48},"end":{"row":295,"column":49}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":299,"column":60},"end":{"row":299,"column":61}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":299,"column":61},"end":{"row":299,"column":62}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":299,"column":62},"end":{"row":299,"column":72}},"text":"sim_Prqing"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":250,"column":0},"end":{"row":250,"column":20}},"text":"  log(INFO, \"done.\")"},{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":250,"column":0}},"nl":"\n","lines":["def check_MGc_assumption():","  # N, Cap = 10, 1","  N_times_Cap = 100","  r = 1","  L = Exp(1, 1)","  S = DUniform(1, 1)","  sinfo_m['njob'] = 2000*10","  sching_m = {'type': 'plain', 'r': r}","  blog(N_times_Cap=N_times_Cap, sinfo_m=sinfo_m, mapping_m=mapping_m, sching_m=sching_m)","  ","  def run(ro, N, k, R, L, S, r=1):","    Cap = int(N_times_Cap/N)","    print(\"\\n\")","    log(INFO, \"ro= {}, N= {}, Cap= {}, k= {}, R= {}, L= {}, S= {}, r= {}\".format(ro, N, Cap, k, R, L, S, r) )","    ","    ar = round(ar_for_ro(ro, N, Cap, k, R, L, S), 2)","    sinfo_m.update({","      'nworker': N, 'wcap': Cap, 'ar': ar,","      'k_rv': k,","      'reqed_rv': R,","      'lifetime_rv': L,","      'straggle_m': {'slowdown': lambda load: S.sample() } } )","    sching_m['r'] = r","    sim_m = sim(sinfo_m, mapping_m, sching_m, \"N{}_C{}\".format(N, Cap) )","    blog(sim_m=sim_m)","    ","    # c = int(N*Cap/R.mean() ) # N*Cap","    # print(\"c= {}\".format(c) )","    # EW = EW_MGc(ar, L, c)","    # print(\"M/G/c_EW= {}\".format(EW) )","    return {","      'ar': ar,","      'EW': sim_m['waittime_mean'],","      'pblocking': sim_m['frac_jobs_waited_inq'],","      'EW_givenqed': sim_m['waittime_givenqed_mean'] }","  ","  def test(ro, R=DUniform(1, 1) ):","    print(\"---------------\")","    run(ro, 1, k, R, L, S)","    # run(ro, 2, k, R, L, S)","    # run(ro, 5, k, R, L, S)","    # run(ro, 10, k, R, L, S)","  ","  def check_EW_scaling_wrt_ro(N, R):","    log(INFO, \"\", N=N, R=R)","    ","    # '''","    ro_l, EW_l = [], []","    for ro in np.linspace(0.1, 0.9, 9):","      ro = round(ro, 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"ro= {}, EW= {}\".format(ro, EW) )","      ","      ro_l.append(ro)","      EW_l.append(EW)","    blog(ro_l=ro_l, EW_l=EW_l)","    # '''","    ","    # ro_l= [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]","    # EW_l= [0.00025548087470978202, 0.00056689800613990546, 0.00089200542402208672, 0.0012637166320921696, 0.0017178514022176334, 0.0021802843452227629, 0.002912705863562876, 0.0061096923858674568, 0.043253547318583753]","    print(\"ratio = EW/(ro/(1-ro))\")","    for i, EW in enumerate(EW_l):","      ro = ro_l[i]","      ratio = EW/(ro/(1-ro) )","      print(\"ro= {}, ratio= {}\".format(ro, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_EL2_over_EL(N, R, ro):","    log(INFO, \"\", N=N, R=R, ro=ro)","    ","    EL2_over_EL_l, EW_l = [], []","    for mu in np.linspace(0.1, 1, 10):","      L = Exp(mu, 1)","      EL2_over_EL = round(L.moment(2)/L.moment(1), 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"EL2_over_EL= {}, EW= {}\".format(EL2_over_EL, EW) )","      ","      EL2_over_EL_l.append(EL2_over_EL)","      EW_l.append(EW)","    blog(EL2_over_EL_l=EL2_over_EL_l, EW_l=EW_l)","    # '''","    ","    print(\"ratio = EW/(EL2/EL)\")","    for i, EW in enumerate(EW_l):","      EL2_over_EL = EL2_over_EL_l[i]","      ratio = EW/EL2_over_EL","      print(\"EL2_over_EL= {}, ratio= {}\".format(EL2_over_EL, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_ER2_over_ER(N, L, ro):","    log(INFO, \"\", N=N, L=L, ro=ro)","    ","    ER2_over_ER_l, EW_l = [], []","    for u in np.linspace(0.1, 1, 10):","      R = Uniform(0.1, u)","      ER2_over_ER = round(R.moment(2)/R.moment(1), 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"ER2_over_ER= {}, EW= {}\".format(ER2_over_ER, EW) )","      ","      ER2_over_ER_l.append(ER2_over_ER)","      EW_l.append(EW)","    blog(ER2_over_ER_l=ER2_over_ER_l, EW_l=EW_l)","    ","    print(\"ratio = EW/(ER2/ER)\")","    for i, EW in enumerate(EW_l):","      ER2_over_ER = ER2_over_ER_l[i]","      ratio = EW/ER2_over_ER","      print(\"ER2_over_ER= {}, ratio= {}\".format(ER2_over_ER, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_Ek2_over_Ek(N, R, L, ro):","    log(INFO, \"\", N=N, R=R, L=L, ro=ro)","    ","    Ek2_over_Ek_l, EW_l = [], []","    for u in range(1, 10):","      k = DUniform(1, u)","      Ek2_over_Ek = round(k.moment(2)/k.moment(1), 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"Ek2_over_Ek= {}, EW= {}\".format(Ek2_over_Ek, EW) )","      ","      Ek2_over_Ek_l.append(Ek2_over_Ek)","      EW_l.append(EW)","    blog(Ek2_over_Ek_l=Ek2_over_Ek_l, EW_l=EW_l)","    ","    print(\"ratio = EW/(ER2/ER)\")","    for i, EW in enumerate(EW_l):","      Ek2_over_Ek = Ek2_over_Ek_l[i]","      ratio = EW/Ek2_over_Ek","      print(\"Ek2_over_Ek= {}, ratio= {}\".format(Ek2_over_Ek, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_model(N, k, R, L, S):","    log(INFO, \"\", N=N, k=k, R=R, L=L, S=S)","    sinfo_m['njob'] = 2000*10","    ","    ET = L.mean()*sum([X_n_k(S, i, i).mean()*k.pdf(i) for i in k.v_l] )","    ET2 = L.moment(2)*sum([X_n_k(S, i, i).moment(2)*k.pdf(i) for i in k.v_l] )","    EL, EL2 = L.mean(), L.moment(2)","    blog(ET=ET, ET2=ET2, EL=EL, EL2=EL2)","    ","    C_moment = lambda i: k.moment(i)*R.moment(i)*L.moment(i)*S.moment(i)","    print(\">> C_moment(1)= {}, C_moment(2)= {}\".format(C_moment(1), C_moment(2) ) )","    ","    def Pr_blocking(ar, ro):","      # narr_atleast_forblocking = (1-ro)*N_times_Cap/(k.moment(1)*R.moment(1) ) - 1","      # blog(narr_atleast_forblocking=narr_atleast_forblocking)","      # ar_ = ar*L.tail(ET)*ET # *L.u_l/10","      # return max(0, \\","      #   1 - math.exp(-ar_)*sum([ar_**i/math.factorial(i) for i in range(int(narr_atleast_forblocking) ) ] ) )","      ","      alpha = 0.9 # 1/2 # L.cdf(L.u_l/10) # L.cdf(10*EL) # 1/2 # L.cdf(EL)","      # print(\"alpha= {}\".format(alpha) )","      long_jlifetime = EL + math.sqrt((EL2 - EL**2)*alpha/(1-alpha) ) # ET + math.sqrt((ET2 - ET**2)*alpha/(1-alpha) )","      ro_short = ar*L.cdf(long_jlifetime)*C_moment(1)/N_times_Cap","      narr_atleast_forblocking = (1-ro_short)*N_times_Cap / (k.moment(1)*R.moment(1) ) - 1","      blog(narr_atleast_forblocking=narr_atleast_forblocking)","      ar_long = ar*L.tail(long_jlifetime)*long_jlifetime","      return max(0, \\","        1 - math.exp(-ar_long)*sum([ar_long**i/math.factorial(i) for i in range(int(narr_atleast_forblocking) ) ] ) )","    ","    def EW_givenqed_model(ro):","      return ro/(1-ro) * C_moment(2)/C_moment(1)","    ","    def EW_model(ar, ro, pblocking=None):","      if pblocking is None:","        pblocking = Pr_blocking(ar, ro)","      print(\"pblocking= {}\".format(pblocking) )","      return ro/(1-ro) * C_moment(2)/C_moment(1) / 2 * pblocking","    ","    EW_l, sim_EW_l = [], []","    # for ro in np.linspace(0.1, 0.9, 9):","    for ro in np.linspace(0.7, 0.9, 3):","      ro = round(ro, 2)","      m = run(ro, N, k, R, L, S)","      ar, sim_EW, sim_pblocking = m['ar'], m['EW'], m['pblocking']","      print(\"ar= {}, ro= {}\".format(ar, ro) )","      ","      pblocking = Pr_blocking(ar, ro)","      print(\"sim_pblocking= {}, pblocking= {}\".format(sim_pblocking, pblocking) )","      EW = EW_model(ar, ro, pblocking)","      print(\"sim_EW= {}, EW= {}\".format(sim_EW, EW) )","      sim_EW_l.append(sim_EW)","      EW_l.append(EW)","      ","      sim_EW_givenqed = m['EW_givenqed']","      EW_givenqed = EW_givenqed_model(ro)","      print(\"sim_EW_givenqed= {}, EW_givenqed= {}\".format(sim_EW_givenqed, EW_givenqed) )","    blog(EW_l=EW_l, sim_EW_l=sim_EW_l)","    ","    # print(\"ratio = sim_EW/model\")","    # for i, sim_EW in enumerate(sim_EW_l):","    #   EW = EW_l[i]","    #   ratio = sim_EW/EW","    #   print(\"EW= {}, ratio= {}\".format(EW, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_w_increasing_r(N, k, R, L, S, ro):","    log(INFO, \"\", N=N, k=k, R=R, L=L, S=S, ro=ro)","    ","    # for r in np.linspace(1, 2, 3):","    for r in range(1, 4):","      m = run(ro, N, k, R, L, S, r)","      ar, sim_EW, sim_pblocking = m['ar'], m['EW'], m['pblocking']","      print(\"ar= {}, ro= {}\".format(ar, ro) )","  ","  # test(ro=0.4)","  # test(ro=0.65)","  # test(ro=0.9)","  ","  # R = Uniform(0.25, 0.75) # Uniform(0.5, 1.5)","  # test(0.9, R)","  ","  # R = Uniform(0.25, 0.75) # Uniform(1, 1) # Uniform(0.05, 0.15) # Uniform(0.5, 1.5)","  # check_EW_scaling_wrt_ro(5, R)","  ","  # R = Uniform(1.5, 2.5) # Uniform(2, 2)","  # check_EW_scaling_wrt_EL2_over_EL(N, R, ro=0.85)","  ","  # L = Exp(0.1, 1)","  # check_EW_scaling_wrt_ER2_over_ER(N, L, ro=0.85)","  ","  # R = Uniform(1, 1) # Uniform(1, 1)","  # L = Exp(0.1, 1) # Uniform(1, 1)","  # check_EW_scaling_wrt_Ek2_over_Ek(N, R, L, ro=0.85)","  ","  k = BZipf(1, 10) # DUniform(1, 1) # DUniform(1, 4)","  R = Uniform(1, 1)","  L = TPareto(10, 10**6, 4) # Exp(0.1, 1) # Uniform(1, 1)","  S = TPareto(1, 10, 2) # Uniform(1, 1)","  check_EW_scaling_wrt_model(N, k, R, L, S)","  "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":20,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":20,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"text":"\n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":0},"end":{"row":3,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":100}},"text":"# ###########################################  Sim  ############################################## #"},{"action":"insertText","range":{"start":{"row":2,"column":100},"end":{"row":3,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":3,"column":0},"end":{"row":145,"column":0}},"lines":["def sim(sinfo_m, mapping_m, sching_m, plotname_suffix=''):","  env = simpy.Environment()","  cl = Cluster_LessReal(env, scher=Scher_wMultiplicativeExpansion(mapping_m, sching_m), **sinfo_m)","  jg = JobGen_LessReal(env, out=cl, **sinfo_m)","  env.run(until=cl.wait_for_alljobs)","  ","  fig, axs = plot.subplots(len(cl.w_l), 1, sharex='col')","  if len(cl.w_l) == 1:","    axs = [axs]","  avg_schedload_l = []","  for i, w in enumerate(cl.w_l):","    print(\"w._id= {}, w.avg_load= {}\".format(w._id, w.avg_load() ) )","    avg_schedload_l.append(w.avg_load() )","    ","    plot.sca(axs[i] )","    t_l, t_load_l = map_to_key__val_l(w.t_load_m)","    plot.plot(t_l, t_load_l, label='w.id= {}'.format(w._id), color=next(darkcolor_c), marker=next(marker_c), linestyle='None')","    plot.ylabel('Load')","    plot.legend()","    plot.xticks(rotation=70)","    plot.xlabel('Time (sec)')","  fig.set_size_inches(2*8, len(cl.w_l)*4)","  plot.subplots_adjust(hspace=0.25, wspace=0.25)","  plot.savefig('plot_wloadovertime_{}_{}.png'.format(sching_m['type'], plotname_suffix), bbox_inches='tight')","  plot.gcf().clear()","  ","  njobs_wfate, ndropped = 0, 0","  njobs_waited_inq = 0","  servtime_l = []","  waittime_l, waittime_givenqed_l = [], []","  responsetime_l = []","  sl_l, serv_sl_l = [], []","  for jid, info in cl.jid_info_m.items():","    if 'fate' in info:","      njobs_wfate += 1","      fate = info['fate']","      if fate == 'dropped':","        ndropped += 1","      elif fate == 'finished':","        servtime_l.append(info['run_time'] )","        serv_sl_l.append(info['run_time']/info['expected_run_time'] )","        sl_l.append(","          (info['wait_time'] + info['run_time'] )/info['expected_run_time'] )","        waittime_l.append(info['wait_time'] )","        responsetime_l.append(info['wait_time'] + info['run_time'] )","        if info['wait_time'] > 0: # 0.01:","          njobs_waited_inq += 1","          waittime_givenqed_l.append(info['wait_time'] )","  frac_jobs_waited_inq = njobs_waited_inq/len(cl.jid_info_m)","  blog(ndropped=ndropped, njobs_wfate=njobs_wfate, frac_jobs_waited_inq=frac_jobs_waited_inq)","  ","  return {","    'drop_rate': ndropped/len(cl.jid_info_m),","    'servtime_mean': np.mean(servtime_l),","    'waittime_mean': np.mean(waittime_l),","    'sl_mean': np.mean(sl_l),","    'sl_std': np.std(sl_l),","    'serv_sl_mean': np.mean(serv_sl_l),","    'load_mean': np.mean(avg_schedload_l),","    'frac_jobs_waited_inq': frac_jobs_waited_inq,","    'waittime_givenqed_mean': np.mean(waittime_givenqed_l),","    'responsetime_mean': np.mean(responsetime_l) }","","def plot_sim():","  blog(sinfo_m=sinfo_m, mapping_m=mapping_m, sching_m=sching_m)","  ","  def plot_wrt_d():","    d_l = []","    # ro_wrep_l, Esl_wrep_l = [], []","    ro_wcoding_l, Esl_wcoding_l = [], []","    sim_ro_wcoding_l, sim_Esl_wcoding_l = [], []","    l, u = a*b, 1000","    for d in np.logspace(math.log10(l), math.log10(u), 5):","      d = round(d, 2)","      print(\"\\n>> d= {}\".format(d) )","      d_l.append(d)","      ","      # red = 'Rep'","      # ro = ro_pareto(ar, N, Cap, k, r, b, beta, a, alpha_gen, d, red)","      # Esl = Esl_pareto(ro, N, Cap, k, r, b, beta, a, alpha_gen, d, red) if ro is not None else None","      # blog(ro=ro, Esl=Esl)","      # ro_wrep_l.append(ro)","      # Esl_wrep_l.append(Esl)","      ","      red = 'Coding'","      ro = ro_pareto(ar, N, Cap, k, r, b, beta, a, alpha_gen, d, red)","      Esl = Esl_pareto(ro, N, Cap, k, r, b, beta, a, alpha_gen, d, red) if ro is not None else None","      blog(ro=ro, Esl=Esl)","      ro_wcoding_l.append(ro)","      Esl_wcoding_l.append(Esl)","      ","      sching_m['threshold'] = d","      sim_m = sim(sinfo_m, mapping_m, sching_m, 'd{}'.format(sching_m['threshold'] ) )","      blog(sim_m=sim_m)","      sim_ro = sim_m['load_mean']","      sim_Esl = sim_m['serv_sl_mean']","      # blog(sim_ro=sim_ro, sim_Esl=sim_Esl)","      sim_ro_wcoding_l.append(sim_ro)","      sim_Esl_wcoding_l.append(sim_Esl)","    # ","    fig, axs = plot.subplots(1, 2)","    fontsize = 14","    ax = axs[0]","    plot.sca(ax)","    # plot.plot(d_l, ro_wrep_l, label='w/ Rep', c='blue', marker=next(marker_c), ls=':', mew=1)","    plot.plot(d_l, ro_wcoding_l, label='w/ Coding', c=next(darkcolor_c), marker=next(marker_c), ls=':', mew=1)","    plot.plot(d_l, sim_ro_wcoding_l, label='Sim, w/ Coding', c=next(darkcolor_c), marker=next(marker_c), ls=':', mew=1)","    prettify(ax)","    plot.legend()","    plot.xscale('log')","    plot.xlabel('d', fontsize=fontsize)","    plot.ylabel('Average load', fontsize=fontsize)","    ax = axs[1]","    plot.sca(ax)","    # plot.plot(d_l, Esl_wrep_l, label='w/ Rep', c='blue', marker=next(marker_c), ls=':', mew=1)","    plot.plot(d_l, Esl_wcoding_l, label='w/ Coding', c=next(darkcolor_c), marker=next(marker_c), ls=':', mew=1)","    plot.plot(d_l, sim_Esl_wcoding_l, label='Sim, w/ Coding', c=next(darkcolor_c), marker=next(marker_c), ls=':', mew=1)","    prettify(ax)","    plot.xscale('log')","    plot.legend()","    plot.xlabel('d', fontsize=fontsize)","    plot.ylabel('Average slowdown', fontsize=fontsize)","  ","  def plot_wrt_ar():","    sching_m['threshold'] = float('Inf')","    ar_ub = ar_for_ro_pareto(0.9, N, Cap, k, b, beta, a, alpha_gen)","    sim_ro_wcoding_l, sim_Esl_wcoding_l = [], []","    for ar in np.linspace(ar_ub/10, ar_ub, 5):","      sinfo_m['ar'] = ar","      sim_m = sim(sinfo_m, mapping_m, sching_m)","      blog(sim_m=sim_m)","      sim_ro = sim_m['load_mean']","      sim_Esl = sim_m['serv_sl_mean']","      # blog(sim_ro=sim_ro, sim_Esl=sim_Esl)","      sim_ro_wcoding_l.append(sim_ro)","      sim_Esl_wcoding_l.append(sim_Esl)","  ","  plot.subplots_adjust(hspace=2)","  st = plot.suptitle(r'$N= {}$, $C= {}$, $k \\sim$ {}, r= {}'.format(N, Cap, k, r) + '\\n' + r'$b= {}$, $\\beta= {}$, $a= {}$, $\\alpha= {}$'.format(b, beta, a, alpha) )","  plot.gcf().set_size_inches(2*5, 5)","  plot.savefig('plot_ro_Esl.png', bbox_extra_artists=(st,), bbox_inches='tight')","  plot.gcf().clear()"]},{"action":"insertText","range":{"start":{"row":145,"column":0},"end":{"row":145,"column":20}},"text":"  log(INFO, \"done.\")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":27},"end":{"row":256,"column":29}},"text":"10"},{"action":"insertText","range":{"start":{"row":256,"column":27},"end":{"row":256,"column":28}},"text":"N"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":22},"end":{"row":256,"column":23}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":22},"end":{"row":256,"column":23}},"text":"3"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":207,"column":42},"end":{"row":207,"column":49}},"text":"0, 0, 0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":207,"column":41},"end":{"row":207,"column":42}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":207,"column":40},"end":{"row":207,"column":41}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":207,"column":39},"end":{"row":207,"column":40}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":207,"column":33},"end":{"row":207,"column":40}},"text":"0, 0, 0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":207,"column":40},"end":{"row":207,"column":41}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":207,"column":41},"end":{"row":207,"column":42}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":207,"column":42},"end":{"row":207,"column":43}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":227,"column":2},"end":{"row":227,"column":4}},"text":"# "}]}]],"redo":[]},"/math_utils.py":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":19,"column":31},"end":{"row":19,"column":31}},"lastUse":1542991078174,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":13},"end":{"row":9,"column":14}},"text":"="}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":14},"end":{"row":9,"column":15}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":15},"end":{"row":9,"column":16}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":16},"end":{"row":9,"column":17}},"text":"'"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":17},"end":{"row":9,"column":18}},"text":"'"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":17},"end":{"row":9,"column":18}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":18},"end":{"row":9,"column":19}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":19},"end":{"row":9,"column":20}},"text":"w"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":20},"end":{"row":9,"column":21}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":21},"end":{"row":9,"column":22}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":23},"end":{"row":9,"column":24}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":24},"end":{"row":10,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":10,"column":0},"end":{"row":10,"column":6}},"text":"      "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":13,"column":4},"end":{"row":13,"column":44}},"text":"return scipy.special.gammainc(z, u)*G(z)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":6},"end":{"row":10,"column":46}},"text":"return scipy.special.gammainc(z, u)*G(z)"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":39},"end":{"row":10,"column":40}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":39},"end":{"row":10,"column":40}},"text":"x"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":46},"end":{"row":11,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":11,"column":0},"end":{"row":11,"column":6}},"text":"      "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":11,"column":4},"end":{"row":11,"column":6}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":4},"end":{"row":11,"column":24}},"text":"if type_ == 'lower':"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":4},"end":{"row":11,"column":5}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":5},"end":{"row":11,"column":6}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":11,"column":19},"end":{"row":11,"column":24}},"text":"lower"},{"action":"insertText","range":{"start":{"row":11,"column":19},"end":{"row":11,"column":20}},"text":"u"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":20},"end":{"row":11,"column":21}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":21},"end":{"row":11,"column":22}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":22},"end":{"row":11,"column":23}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":23},"end":{"row":11,"column":24}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":26},"end":{"row":12,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":12,"column":0},"end":{"row":12,"column":6}},"text":"      "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":44}},"text":"    return scipy.special.gammainc(z, l)*G(z)"},{"action":"removeText","range":{"start":{"row":17,"column":4},"end":{"row":17,"column":53}},"text":"# return (1 - scipy.special.gammainc(z, l) )*G(z)"},{"action":"removeText","range":{"start":{"row":17,"column":4},"end":{"row":18,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":6},"end":{"row":12,"column":55}},"text":"# return (1 - scipy.special.gammainc(z, l) )*G(z)"},{"action":"insertText","range":{"start":{"row":12,"column":55},"end":{"row":13,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":13,"column":0},"end":{"row":13,"column":46}},"text":"      return scipy.special.gammainc(z, l)*G(z)"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":15,"column":0},"end":{"row":19,"column":0}},"nl":"\n","lines":["  elif u is not None:","    ","  elif l is not None:","    "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":15,"column":0},"end":{"row":16,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":14,"column":2},"end":{"row":14,"column":4}},"text":"  "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":14,"column":0},"end":{"row":14,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":35},"end":{"row":13,"column":36}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":13,"column":40},"end":{"row":13,"column":41}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":40},"end":{"row":13,"column":41}},"text":"x"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":46},"end":{"row":12,"column":47}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":46},"end":{"row":12,"column":47}},"text":"x"}]}]],"redo":[]},"/model_checking_wmpi.py":{"scrollTop":2051,"scrollLeft":0,"selection":{"start":{"row":122,"column":38},"end":{"row":122,"column":38}},"lastUse":1542989586600,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":18},"end":{"row":131,"column":19}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":19},"end":{"row":131,"column":20}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":20},"end":{"row":131,"column":21}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":21},"end":{"row":131,"column":22}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":131,"column":12},"end":{"row":131,"column":15}},"text":"500"},{"action":"insertText","range":{"start":{"row":131,"column":12},"end":{"row":131,"column":13}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":14},"end":{"row":103,"column":23}},"text":", sPrqing"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":39},"end":{"row":104,"column":40}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":40},"end":{"row":104,"column":41}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":41},"end":{"row":104,"column":48}},"text":"sPrqing"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":48},"end":{"row":104,"column":49}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":49},"end":{"row":104,"column":50}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":50},"end":{"row":104,"column":51}},"text":"{"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":51},"end":{"row":104,"column":52}},"text":"}"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":75},"end":{"row":104,"column":76}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":76},"end":{"row":104,"column":77}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":104,"column":77},"end":{"row":104,"column":84}},"text":"sPrqing"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":106,"column":34},"end":{"row":106,"column":35}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":106,"column":35},"end":{"row":106,"column":36}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":106,"column":36},"end":{"row":106,"column":43}},"text":"sPrqing"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":106,"column":13},"end":{"row":106,"column":14}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":106,"column":14},"end":{"row":106,"column":21}},"text":"sPrqing"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":107,"column":17},"end":{"row":107,"column":24}},"text":"sET_sEW"},{"action":"insertText","range":{"start":{"row":107,"column":17},"end":{"row":107,"column":32}},"text":"sET_sEW_sPrqing"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":86,"column":19},"end":{"row":86,"column":20}},"text":"\\"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":86,"column":28},"end":{"row":86,"column":29}},"text":"\\"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":88,"column":32},"end":{"row":88,"column":33}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":88,"column":32},"end":{"row":88,"column":33}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":131,"column":12},"end":{"row":131,"column":20}},"text":"10*N, # "}]}]],"redo":[]},"/modeling_deprecated.py":{"scrollTop":9980.5,"scrollLeft":0,"selection":{"start":{"row":510,"column":15},"end":{"row":510,"column":15}},"lastUse":1542942814288,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":1,"column":0}},"text":"\n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":3}},"text":"'''"},{"action":"insertText","range":{"start":{"row":2,"column":3},"end":{"row":3,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":3,"column":0},"end":{"row":175,"column":0}},"lines":["Kubernetes architecture; master assigning jobs to distributed workers.","Average cluster load = E[ro] = ar/N/Cap * E[D x S]","where","ar: Arrival rate of jobs","N: Number of workers","Cap: Capacity of each worker","k: Number of tasks in a job.","D: Total demand of a task; lifetime x resource demand","S: Slowdown experienced by each task","","S is assumed to depend only on ro.","Redundancy is introduced for jobs with D < d.","'''","def E_slowdown(ar, N, Cap, k, D, S_gen, d=None, r=None):","  ## E[kD | kD <= d] = E[k x E[D | D <= d/k]]","  E_D_given_D_leq_doverk = lambda k: mean(D, given_X_leq_x=True, x=d/k)","  E_D_given_D_g_doverk = lambda k: mean(D, given_X_leq_x=False, x=d/k)","  # E_kD_given_kD_leq_d = float(","  #   mpmath.quad(lambda i: i*E_D_given_D_leq_doverk(i)*k.pdf(i), [0, mpmath.inf] ) )","  ","  if d is not None:","    Pr_kD_leq_d = sum([D.cdf(d/i)*k.pdf(i) for i in k.v_l] )","    blog(Pr_kD_leq_d=Pr_kD_leq_d)","  def ro_(ro):","    S = S_gen(ro)","    if d is not None:","      ES = S.mean()","      ","      ## kD <= d","      def E_cumS(k_):","        E = 0","        for i in range(1, k_+1):","          S_kplusr_i = X_n_k(S, k_+r, i)","          E += (r+1)*S_kplusr_i.mean() if i == k_ else S_kplusr_i.mean()","        return E","      EC_given_kD_leq_d = sum([E_cumS(i)*E_D_given_D_leq_doverk(i)*k.pdf(i) for i in k.v_l] )","      ","      ## kD > d","      EC_given_kD_g_d = ES*sum([i*E_D_given_D_g_doverk(i)*k.pdf(i) for i in k.v_l] )","      ","      # log(INFO, \"d= {}, ro= {}\".format(d, ro), EC_given_kD_leq_d=EC_given_kD_leq_d, EC_given_kD_g_d=EC_given_kD_g_d, Pr_kD_leq_d=Pr_kD_leq_d)","      EA = EC_given_kD_leq_d*Pr_kD_leq_d + \\","           EC_given_kD_g_d*(1 - Pr_kD_leq_d)","    else:","      EA = k.mean()*D.mean()*S.mean()","    return ar/N/Cap * EA","  ","  eq = lambda ro: ro - ro_(ro)","  l, u = 0.0001, 1","  # for x in np.linspace(l, u, 10):","  #   print(\"eq({})= {}\".format(x, eq(x) ) )","  ","  max_eq, u_w_max_eq = float('-inf'), 0","  u_w_max_eq","  eq_u = -1","  while u > l and eq_u < -0.01:","    eq_u = eq(u)","    if eq_u > max_eq:","      max_eq = eq_u","      u_w_max_eq = u","    u -= 0.05","  if u < l:","    print(\"u < l; u_w_max_eq= {}, max_eq= {}\".format(u_w_max_eq, max_eq) )","    found_it = False","    for u in np.linspace(u_w_max_eq-0.05, u_w_max_eq+0.05, 10):","      if eq(u) > -0.01:","        found_it = True","        break","    if not found_it:","      return None","  print(\"l= {}, u= {}\".format(l, u) )","  ","  # eq_l, eq_u = eq(l), eq(u)","  # print(\"eq({})= {}, eq({})= {}\".format(l, eq_l, u, eq_u) )","  # if eq_l*eq_u > 0:","  #   return None","  ","  ro = scipy.optimize.brentq(eq, l, u)","  # ro = scipy.optimize.newton(eq, 1)","  # ro = scipy.optimize.fixed_point(ro_, 0.5)","  # ro = scipy.optimize.fixed_point(ro_, [0.01, 0.99] )","  log(INFO, \"ro= {}\".format(ro), d=d)","  # for x in np.linspace(l, u, 40):","  #   print(\"eq({})= {}\".format(x, eq(x) ) )","  ","  S = S_gen(ro)","  E_S_given_kD_g_d = sum([X_n_k(S, i, i).mean()*k.pdf(i) for i in k.v_l] )","  if d is not None:","    E_S_given_kD_leq_d = sum([X_n_k(S, i+r, i).mean()*k.pdf(i) for i in k.v_l] )","    return E_S_given_kD_leq_d*Pr_kD_leq_d + \\","           E_S_given_kD_g_d*(1 - Pr_kD_leq_d)","  else:","    return E_S_given_kD_g_d","  ","def arrival_rate_ub(N, Cap, k, D, S_gen):","  return N*Cap/k.mean()/D.mean()/S_gen(1).mean()  ","","def arrival_rate_for_load_ro(ro, N, Cap, k, D, S_gen):","  return ro*N*Cap/k.mean()/D.mean()/S_gen(ro).mean()","","def plot_slowdown():","  N, Cap = 10, 100","  D = TPareto(1, 1000, 1) # Pareto(10, 2)","  k = BZipf(1, 10)","  r = 1","  ","  # S_gen = lambda ro: TPareto(1, 40, 2/ro)","  def S_gen(ro):","    # a = 2 - ro # 1.5 - math.sqrt(ro)","    a = 1.1/ro","    if a < 0:","      log(ERROR, \"a= {} < 0!\".format(a), ro=ro)","      a = float(\"inf\")","    return TPareto(1, 100, a)","  ar_ub = arrival_rate_ub(N, Cap, k, D, S_gen)","  print(\"ar_ub= {}\".format(ar_ub) )","  ","  # d = 2*D.mean()","  # for ar in np.linspace(ar_ub/20, ar_ub, 10):","  #   E_sl = E_slowdown(ar, N, Cap, k, D, S_gen)","  #   E_sl_wred = E_slowdown(ar, N, Cap, k, D, S_gen, d, r)","  #   print(\"ar= {}, E_sl= {}, E_sl_wred= {}\".format(ar, E_sl, E_sl_wred) )","  ","  # ar = 1/4*ar_ub # 1/2, 2/3","  ar = arrival_rate_for_load_ro(1/2, N, Cap, k, D, S_gen)","  ","  l, u = 1.1*D.l_l, 0.95*D.u_l","  # for d in np.linspace(l, u, 10):","  E_sl = E_slowdown(ar, N, Cap, k, D, S_gen)","  print(\"E_sl= {}\".format(E_sl) )","  ","  d_l, E_sl_wred_l = [], []","  for d in np.logspace(math.log10(l), math.log10(u), 10):","  # for d in [11, 20]:","  # for d in [l, u]:","    print(\"\\n>> d= {}\".format(d) )","    d_l.append(d)","    ","    E_sl_wred = E_slowdown(ar, N, Cap, k, D, S_gen, d, r)","    blog(E_sl=E_sl, E_sl_wred=E_sl_wred)","    E_sl_wred_l.append(E_sl_wred)","    # if E_sl_wred is None:","    #   break","  ","  plot.axhline(y=E_sl, label=r'w/o red', c=next(darkcolor_c) )","  plot.plot(d_l, E_sl_wred_l, label=r'w/ red', c=next(darkcolor_c), marker=next(marker_c), ls=':', mew=2)","  plot.legend()","  plot.xlabel('d', fontsize=fontsize)","  plot.ylabel('Average slowdown', fontsize=fontsize)","  plot.title('N= {}, Cap= {}, D$\\sim {}$\\n'.format(N, Cap, D.tolatex() ) + 'k$\\sim${}, r= {}'.format(k, r) )","  plot.savefig('plot_slowdown.png')","  plot.gcf().clear()","  log(INFO, \"done.\")","","def test():","  N, Cap = 10, 100","  D = TPareto(1, 1000, 1) # Pareto(10, 2)","  k = BZipf(1, 10)","  ","  def do_for(d):","    E_D_given_D_leq_doverk = lambda k_: mean(D, given_X_leq_x=True, x=d/k_)","    E_D_given_D_g_doverk = lambda k_: mean(D, given_X_leq_x=False, x=d/k_)","    ","    E_kD_given_kD_leq_d = sum([i*E_D_given_D_leq_doverk(i)*k.pdf(i) for i in k.v_l] )","    Pr_kD_leq_d = sum([D.cdf(d/i)*k.pdf(i) for i in k.v_l] )","    E_kD_given_kD_g_d = sum([i*E_D_given_D_g_doverk(i)*k.pdf(i) for i in k.v_l] )","    ","    E_kD = k.mean()*D.mean()","    E_kD_totalsum = Pr_kD_leq_d*E_kD_given_kD_leq_d + (1 - Pr_kD_leq_d)*E_kD_given_kD_g_d","    log(INFO, \"d= {}\".format(d), E_kD=E_kD, E_kD_totalsum=E_kD_totalsum)","  ","  for d in np.linspace(10, 1000, 10):"]},{"action":"insertText","range":{"start":{"row":175,"column":0},"end":{"row":175,"column":13}},"text":"    do_for(d)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":175,"column":13},"end":{"row":176,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":176,"column":0},"end":{"row":176,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":176,"column":2},"end":{"row":176,"column":4}},"text":"  "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":176,"column":0},"end":{"row":176,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":18}},"text":"import numpy as np"},{"action":"insertText","range":{"start":{"row":0,"column":18},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":76,"column":0}},"lines":["import mpmath","","from rvs import *","","'''","Kubernetes architecture; master assigning jobs to distributed workers.","Average cluster load = E[ro] = ar/N/Cap * E[D x S]","where","ar: Arrival rate of jobs","N: Number of workers","Cap: Capacity of each worker","D: Total demand of a job; lifetime x resource demand","S: Slowdown experienced by each task","","S is assumed to depend only on ro.","Redundancy is introduced for jobs with D < D0.","'''","def E_slowdown(ar, N, Cap, D, S_gen, D0=None):","  def ro_(ro):","    if D0 is not None:","      ED_given_D_leq_D0 = mean(D, given_X_leq_x=True, x=D0)","      S = S_gen(ro)","      S_2_1 = X_n_k(S, 2, 1)","      ES_given_D_leq_D0 = S_2_1.moment(1)","      ","      ED_given_D_g_D0 = mean(D, given_X_leq_x=False, x=D0)","      ES_given_D_g_D0 = S.moment(1)","      # blog(E_S_2_1=ES_given_D_leq_D0, ES=ES_given_D_g_D0)","      ","      Pr_D_leq_D0 = D.cdf(D0)","      ","      EA = 2*ED_given_D_leq_D0*ES_given_D_leq_D0*Pr_D_leq_D0 + \\","           ED_given_D_g_D0*ES_given_D_g_D0*(1 - Pr_D_leq_D0)","    else:","      EA = D.mean()*S_gen(ro).mean()","    return ar/N/Cap * EA","  ","  eq = lambda ro: ro - ro_(ro)","  l, u = 0.0001, 1","  roots = scipy.optimize.brentq(eq, l, u)","  print(\"roots= {}\".format(roots) )","  # for x in np.linspace(l, u, 40):","  #   print(\"eq({})= {}\".format(x, eq(x) ) )","  ","  S = S_gen(roots)","  return S.mean()","","def arrival_rate_ub(N, Cap, D, S_gen):","  return N*Cap/D.mean()/S_gen(1).mean()  ","","def plot_slowdown():","  N, Cap = 10, 100","  D = TPareto(1, 10000, 2) # Pareto(10, 2)","  ","  # S_gen = lambda ro: TPareto(1, 40, 2/ro)","  def S_gen(ro):","    a = 1.5 - math.sqrt(ro) # 2 - ro","    return TPareto(1, 1000, a)","  ar_ub = arrival_rate_ub(N, Cap, D, S_gen)","  print(\"ar_ub= {}\".format(ar_ub) )","  ","  # D0 = 2*D.mean()","  # for ar in np.linspace(ar_ub/20, ar_ub, 10):","  #   E_sl = E_slowdown(ar, N, Cap, D, S_gen)","  #   E_sl_wred = E_slowdown(ar, N, Cap, D, S_gen, D0)","  #   print(\"ar= {}, E_sl= {}, E_sl_wred= {}\".format(ar, E_sl, E_sl_wred) )","  ","  ar = 1/2*ar_ub # 2/3","  l, u = 1.1*D.l_l, 0.95*D.u_l","  # for D0 in np.linspace(l, u, 10):","  for D0 in np.logspace(math.log10(l), math.log10(u), 10):","    print(\"D0= {}\".format(D0) )","    E_sl = E_slowdown(ar, N, Cap, D, S_gen)","    E_sl_wred = E_slowdown(ar, N, Cap, D, S_gen, D0)","    blog(E_sl=E_sl, E_sl_wred=E_sl_wred)"]},{"action":"insertText","range":{"start":{"row":76,"column":0},"end":{"row":76,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":252,"column":0},"end":{"row":253,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":253,"column":0},"end":{"row":253,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":253,"column":2},"end":{"row":253,"column":29}},"text":"def check_MGc_assumption():"},{"action":"insertText","range":{"start":{"row":253,"column":29},"end":{"row":254,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":254,"column":0},"end":{"row":484,"column":0}},"lines":["  # N, Cap = 10, 1","  N_times_Cap = 100","  r = 1","  L = Exp(1, 1)","  S = DUniform(1, 1)","  sinfo_m['njob'] = 2000*10","  sching_m = {'type': 'plain', 'r': r}","  blog(N_times_Cap=N_times_Cap, sinfo_m=sinfo_m, mapping_m=mapping_m, sching_m=sching_m)","  ","  def run(ro, N, k, R, L, S, r=1):","    Cap = int(N_times_Cap/N)","    print(\"\\n\")","    log(INFO, \"ro= {}, N= {}, Cap= {}, k= {}, R= {}, L= {}, S= {}, r= {}\".format(ro, N, Cap, k, R, L, S, r) )","    ","    ar = round(ar_for_ro(ro, N, Cap, k, R, L, S), 2)","    sinfo_m.update({","      'nworker': N, 'wcap': Cap, 'ar': ar,","      'k_rv': k,","      'reqed_rv': R,","      'lifetime_rv': L,","      'straggle_m': {'slowdown': lambda load: S.sample() } } )","    sching_m['r'] = r","    sim_m = sim(sinfo_m, mapping_m, sching_m, \"N{}_C{}\".format(N, Cap) )","    blog(sim_m=sim_m)","    ","    # c = int(N*Cap/R.mean() ) # N*Cap","    # print(\"c= {}\".format(c) )","    # EW = EW_MGc(ar, L, c)","    # print(\"M/G/c_EW= {}\".format(EW) )","    return {","      'ar': ar,","      'EW': sim_m['waittime_mean'],","      'pblocking': sim_m['frac_jobs_waited_inq'],","      'EW_givenqed': sim_m['waittime_givenqed_mean'] }","  ","  def test(ro, R=DUniform(1, 1) ):","    print(\"---------------\")","    run(ro, 1, k, R, L, S)","    # run(ro, 2, k, R, L, S)","    # run(ro, 5, k, R, L, S)","    # run(ro, 10, k, R, L, S)","  ","  def check_EW_scaling_wrt_ro(N, R):","    log(INFO, \"\", N=N, R=R)","    ","    # '''","    ro_l, EW_l = [], []","    for ro in np.linspace(0.1, 0.9, 9):","      ro = round(ro, 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"ro= {}, EW= {}\".format(ro, EW) )","      ","      ro_l.append(ro)","      EW_l.append(EW)","    blog(ro_l=ro_l, EW_l=EW_l)","    # '''","    ","    # ro_l= [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]","    # EW_l= [0.00025548087470978202, 0.00056689800613990546, 0.00089200542402208672, 0.0012637166320921696, 0.0017178514022176334, 0.0021802843452227629, 0.002912705863562876, 0.0061096923858674568, 0.043253547318583753]","    print(\"ratio = EW/(ro/(1-ro))\")","    for i, EW in enumerate(EW_l):","      ro = ro_l[i]","      ratio = EW/(ro/(1-ro) )","      print(\"ro= {}, ratio= {}\".format(ro, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_EL2_over_EL(N, R, ro):","    log(INFO, \"\", N=N, R=R, ro=ro)","    ","    EL2_over_EL_l, EW_l = [], []","    for mu in np.linspace(0.1, 1, 10):","      L = Exp(mu, 1)","      EL2_over_EL = round(L.moment(2)/L.moment(1), 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"EL2_over_EL= {}, EW= {}\".format(EL2_over_EL, EW) )","      ","      EL2_over_EL_l.append(EL2_over_EL)","      EW_l.append(EW)","    blog(EL2_over_EL_l=EL2_over_EL_l, EW_l=EW_l)","    # '''","    ","    print(\"ratio = EW/(EL2/EL)\")","    for i, EW in enumerate(EW_l):","      EL2_over_EL = EL2_over_EL_l[i]","      ratio = EW/EL2_over_EL","      print(\"EL2_over_EL= {}, ratio= {}\".format(EL2_over_EL, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_ER2_over_ER(N, L, ro):","    log(INFO, \"\", N=N, L=L, ro=ro)","    ","    ER2_over_ER_l, EW_l = [], []","    for u in np.linspace(0.1, 1, 10):","      R = Uniform(0.1, u)","      ER2_over_ER = round(R.moment(2)/R.moment(1), 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"ER2_over_ER= {}, EW= {}\".format(ER2_over_ER, EW) )","      ","      ER2_over_ER_l.append(ER2_over_ER)","      EW_l.append(EW)","    blog(ER2_over_ER_l=ER2_over_ER_l, EW_l=EW_l)","    ","    print(\"ratio = EW/(ER2/ER)\")","    for i, EW in enumerate(EW_l):","      ER2_over_ER = ER2_over_ER_l[i]","      ratio = EW/ER2_over_ER","      print(\"ER2_over_ER= {}, ratio= {}\".format(ER2_over_ER, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_Ek2_over_Ek(N, R, L, ro):","    log(INFO, \"\", N=N, R=R, L=L, ro=ro)","    ","    Ek2_over_Ek_l, EW_l = [], []","    for u in range(1, 10):","      k = DUniform(1, u)","      Ek2_over_Ek = round(k.moment(2)/k.moment(1), 2)","      ar, EW, pblocking = run(ro, N, k, R, L, S)","      print(\"Ek2_over_Ek= {}, EW= {}\".format(Ek2_over_Ek, EW) )","      ","      Ek2_over_Ek_l.append(Ek2_over_Ek)","      EW_l.append(EW)","    blog(Ek2_over_Ek_l=Ek2_over_Ek_l, EW_l=EW_l)","    ","    print(\"ratio = EW/(ER2/ER)\")","    for i, EW in enumerate(EW_l):","      Ek2_over_Ek = Ek2_over_Ek_l[i]","      ratio = EW/Ek2_over_Ek","      print(\"Ek2_over_Ek= {}, ratio= {}\".format(Ek2_over_Ek, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_wrt_model(N, k, R, L, S):","    log(INFO, \"\", N=N, k=k, R=R, L=L, S=S)","    sinfo_m['njob'] = 2000*10","    ","    ET = L.mean()*sum([X_n_k(S, i, i).mean()*k.pdf(i) for i in k.v_l] )","    ET2 = L.moment(2)*sum([X_n_k(S, i, i).moment(2)*k.pdf(i) for i in k.v_l] )","    EL, EL2 = L.mean(), L.moment(2)","    blog(ET=ET, ET2=ET2, EL=EL, EL2=EL2)","    ","    C_moment = lambda i: k.moment(i)*R.moment(i)*L.moment(i)*S.moment(i)","    print(\">> C_moment(1)= {}, C_moment(2)= {}\".format(C_moment(1), C_moment(2) ) )","    ","    def Pr_blocking(ar, ro):","      # narr_atleast_forblocking = (1-ro)*N_times_Cap/(k.moment(1)*R.moment(1) ) - 1","      # blog(narr_atleast_forblocking=narr_atleast_forblocking)","      # ar_ = ar*L.tail(ET)*ET # *L.u_l/10","      # return max(0, \\","      #   1 - math.exp(-ar_)*sum([ar_**i/math.factorial(i) for i in range(int(narr_atleast_forblocking) ) ] ) )","      ","      alpha = 0.9 # 1/2 # L.cdf(L.u_l/10) # L.cdf(10*EL) # 1/2 # L.cdf(EL)","      # print(\"alpha= {}\".format(alpha) )","      long_jlifetime = EL + math.sqrt((EL2 - EL**2)*alpha/(1-alpha) ) # ET + math.sqrt((ET2 - ET**2)*alpha/(1-alpha) )","      ro_short = ar*L.cdf(long_jlifetime)*C_moment(1)/N_times_Cap","      narr_atleast_forblocking = (1-ro_short)*N_times_Cap / (k.moment(1)*R.moment(1) ) - 1","      blog(narr_atleast_forblocking=narr_atleast_forblocking)","      ar_long = ar*L.tail(long_jlifetime)*long_jlifetime","      return max(0, \\","        1 - math.exp(-ar_long)*sum([ar_long**i/math.factorial(i) for i in range(int(narr_atleast_forblocking) ) ] ) )","    ","    def EW_givenqed_model(ro):","      return ro/(1-ro) * C_moment(2)/C_moment(1)","    ","    def EW_model(ar, ro, pblocking=None):","      if pblocking is None:","        pblocking = Pr_blocking(ar, ro)","      print(\"pblocking= {}\".format(pblocking) )","      return ro/(1-ro) * C_moment(2)/C_moment(1) / 2 * pblocking","    ","    EW_l, sim_EW_l = [], []","    # for ro in np.linspace(0.1, 0.9, 9):","    for ro in np.linspace(0.7, 0.9, 3):","      ro = round(ro, 2)","      m = run(ro, N, k, R, L, S)","      ar, sim_EW, sim_pblocking = m['ar'], m['EW'], m['pblocking']","      print(\"ar= {}, ro= {}\".format(ar, ro) )","      ","      pblocking = Pr_blocking(ar, ro)","      print(\"sim_pblocking= {}, pblocking= {}\".format(sim_pblocking, pblocking) )","      EW = EW_model(ar, ro, pblocking)","      print(\"sim_EW= {}, EW= {}\".format(sim_EW, EW) )","      sim_EW_l.append(sim_EW)","      EW_l.append(EW)","      ","      sim_EW_givenqed = m['EW_givenqed']","      EW_givenqed = EW_givenqed_model(ro)","      print(\"sim_EW_givenqed= {}, EW_givenqed= {}\".format(sim_EW_givenqed, EW_givenqed) )","    blog(EW_l=EW_l, sim_EW_l=sim_EW_l)","    ","    # print(\"ratio = sim_EW/model\")","    # for i, sim_EW in enumerate(sim_EW_l):","    #   EW = EW_l[i]","    #   ratio = sim_EW/EW","    #   print(\"EW= {}, ratio= {}\".format(EW, ratio) )","    log(INFO, \"done.\")","  ","  def check_EW_scaling_w_increasing_r(N, k, R, L, S, ro):","    log(INFO, \"\", N=N, k=k, R=R, L=L, S=S, ro=ro)","    ","    # for r in np.linspace(1, 2, 3):","    for r in range(1, 4):","      m = run(ro, N, k, R, L, S, r)","      ar, sim_EW, sim_pblocking = m['ar'], m['EW'], m['pblocking']","      print(\"ar= {}, ro= {}\".format(ar, ro) )","  ","  # test(ro=0.4)","  # test(ro=0.65)","  # test(ro=0.9)","  ","  # R = Uniform(0.25, 0.75) # Uniform(0.5, 1.5)","  # test(0.9, R)","  ","  # R = Uniform(0.25, 0.75) # Uniform(1, 1) # Uniform(0.05, 0.15) # Uniform(0.5, 1.5)","  # check_EW_scaling_wrt_ro(5, R)","  ","  # R = Uniform(1.5, 2.5) # Uniform(2, 2)","  # check_EW_scaling_wrt_EL2_over_EL(N, R, ro=0.85)","  ","  # L = Exp(0.1, 1)","  # check_EW_scaling_wrt_ER2_over_ER(N, L, ro=0.85)","  ","  # R = Uniform(1, 1) # Uniform(1, 1)","  # L = Exp(0.1, 1) # Uniform(1, 1)","  # check_EW_scaling_wrt_Ek2_over_Ek(N, R, L, ro=0.85)","  ","  k = BZipf(1, 10) # DUniform(1, 1) # DUniform(1, 4)","  R = Uniform(1, 1)","  L = TPareto(10, 10**6, 4) # Exp(0.1, 1) # Uniform(1, 1)","  S = TPareto(1, 10, 2) # Uniform(1, 1)","  check_EW_scaling_wrt_model(N, k, R, L, S)","  "]},{"action":"insertText","range":{"start":{"row":484,"column":0},"end":{"row":484,"column":20}},"text":"  log(INFO, \"done.\")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":253,"column":0},"end":{"row":253,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":484,"column":20},"end":{"row":485,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":485,"column":0},"end":{"row":485,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":485,"column":0},"end":{"row":485,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":485,"column":0},"end":{"row":486,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":486,"column":0},"end":{"row":486,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":486,"column":2},"end":{"row":486,"column":13}},"text":"def test():"},{"action":"insertText","range":{"start":{"row":486,"column":13},"end":{"row":487,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":487,"column":0},"end":{"row":552,"column":0}},"lines":["  N, Cap = 4, 2","  b, beta = 10, 1.1","  a, alpha = 1, 2","  k = BZipf(1, 2)","  r = 2","  log(INFO, \"\", k=k, r=r, b=b, beta=beta, a=a, alpha=alpha)","  ","  D = Exp(beta, b) # Pareto(b, beta)","  S = Exp(alpha, a) # Pareto(a, alpha)","  Ek = k.mean()","  ES = S.mean()","  ED = D.mean()","  ","  def gen_sim_E_kD_given_kD_leq_d(d, nsamples=100*1000):","    sum_sample = 0","    for _ in range(nsamples):","      k_sample = k.sample()","      D_sample = D.sample()","      kD_sample = k_sample*D_sample","      if kD_sample <= d:","        sum_sample += kD_sample","    return sum_sample/nsamples","  ","  def Pr_kD(x):","    return sum([D.pdf(x/i)*k.pdf(i) for i in k.v_l] )","  def Pr_kD_leq_x(x):","    return sum([D.cdf(x/i)*k.pdf(i) for i in k.v_l] )","  ","  E_kD = Ek*ED","  # E_kD_ = mpmath.quad(lambda x: x*Pr_kD(x), [0, mpmath.inf] )","  # E_kD__ = mpmath.quad(lambda x: 1 - Pr_kD_leq_x(x), [0, mpmath.inf] )","  E_kD_ = scipy.integrate.quad(lambda x: x*Pr_kD(x), 0, np.inf)[0]","  E_kD__ = scipy.integrate.quad(lambda x: 1 - Pr_kD_leq_x(x), 0, np.inf)[0]","  print(\"E_kD= {}, E_kD_= {}, E_kD__= {}\".format(E_kD, E_kD_, E_kD__) )","  # ","  def compute(d):","    Pr_kD_leq_d = Pr_kD_leq_d_pareto(k, b, beta, d)","    ","    # mpmath.quad(lambda x: x*Pr_kD(x), [0, d] ) \\","    E_kD_given_kD_leq_d = scipy.integrate.quad(lambda x: x*Pr_kD(x), 0, d)[0] \\","                        / Pr_kD_leq_d if Pr_kD_leq_d != 0 else 0","    ","    # ED_given_D_g_doverk = lambda k: mean(D, given_X_leq_x=False, x=d/k)","    # EkD_given_kD_g_d = sum([i*ED_given_D_g_doverk(i)*k.pdf(i) for i in k.v_l] )","    EkD_given_kD_g_d = (Ek*ED - scipy.integrate.quad(lambda x: x*Pr_kD(x), 0, d)[0] ) \\","                      / (1 - Pr_kD_leq_d) if Pr_kD_leq_d != 0 else Ek*ED","    ","    log(INFO, \"\", diff=(Ek*ED - (E_kD_given_kD_leq_d*Pr_kD_leq_d + EkD_given_kD_g_d*(1 - Pr_kD_leq_d) ) ) )","    blog(E_kD_given_kD_leq_d=E_kD_given_kD_leq_d, EkD_given_kD_g_d=EkD_given_kD_g_d, Pr_kD_leq_d=Pr_kD_leq_d)","    ","    # Using law of total expectation","    ED_given_D_leq_doverk = lambda k: mean(D, given_X_leq_x=True, x=d/k)","    EkD_given_kD_leq_d_ = sum([i*ED_given_D_leq_doverk(i)*k.pdf(i) for i in k.v_l] )","    ED_given_D_g_doverk = lambda k: mean(D, given_X_leq_x=False, x=d/k)","    EkD_given_kD_g_d_ = sum([i*ED_given_D_g_doverk(i)*k.pdf(i) for i in k.v_l] )","    blog(EkD_given_kD_leq_d_=EkD_given_kD_leq_d_, EkD_given_kD_g_d_=EkD_given_kD_g_d_)","  ","    sim_E_kD_given_kD_leq_d = gen_sim_E_kD_given_kD_leq_d(d)","    blog(sim_E_kD_given_kD_leq_d=sim_E_kD_given_kD_leq_d)","  ","  l, u = a*b, 1000","  for d in np.logspace(math.log10(l), math.log10(u), 10):","    print(\"\\n>> d= {}\".format(d) )","    compute(d)","  "]},{"action":"insertText","range":{"start":{"row":552,"column":0},"end":{"row":552,"column":20}},"text":"  log(INFO, \"done.\")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":486,"column":0},"end":{"row":486,"column":2}},"text":"  "}]}]],"redo":[]},"/mgn_model.py":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":23,"column":15},"end":{"row":23,"column":15}},"lastUse":1542942205197,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":283,"column":26},"end":{"row":283,"column":27}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":283,"column":27},"end":{"row":283,"column":28}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":283,"column":28},"end":{"row":283,"column":29}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":283,"column":25},"end":{"row":283,"column":26}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":16},"end":{"row":256,"column":17}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":16},"end":{"row":256,"column":17}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":17},"end":{"row":256,"column":18}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":18},"end":{"row":256,"column":19}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":18},"end":{"row":256,"column":19}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":18},"end":{"row":256,"column":19}},"text":"5"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":18},"end":{"row":256,"column":19}},"text":"5"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":17},"end":{"row":256,"column":18}},"text":"."}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":16},"end":{"row":256,"column":17}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":16},"end":{"row":256,"column":17}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":17},"end":{"row":256,"column":18}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":18},"end":{"row":256,"column":19}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":18},"end":{"row":256,"column":19}},"text":"1"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":17},"end":{"row":256,"column":18}},"text":"."}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":16},"end":{"row":256,"column":17}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":256,"column":16},"end":{"row":256,"column":17}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":18,"column":0},"end":{"row":19,"column":0}},"text":"\n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":0},"end":{"row":20,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":0},"end":{"row":19,"column":21}},"text":"def EW_MGc(ar, X, c):"},{"action":"insertText","range":{"start":{"row":19,"column":21},"end":{"row":20,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":20,"column":0},"end":{"row":22,"column":0}},"lines":["EX2, EX = X.moment(2), X.moment(1)","CoeffVar = math.sqrt(EX2 - EX**2)/EX"]},{"action":"insertText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":46}},"text":"return (1 + CoeffVar**2)/2 * EW_MMc(ar, EX, c)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":20,"column":0},"end":{"row":20,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":10},"end":{"row":19,"column":11}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":16},"end":{"row":19,"column":17}},"text":"E"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":19,"column":19},"end":{"row":19,"column":20}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":19,"column":18},"end":{"row":19,"column":19}},"text":","}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":19,"column":17},"end":{"row":19,"column":18}},"text":"X"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":19,"column":16},"end":{"row":19,"column":17}},"text":"E"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":17},"end":{"row":19,"column":18}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":18},"end":{"row":19,"column":19}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":19},"end":{"row":19,"column":20}},"text":"E"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":20},"end":{"row":19,"column":21}},"text":"X"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":21},"end":{"row":19,"column":22}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":22},"end":{"row":19,"column":23}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":23},"end":{"row":19,"column":24}},"text":"E"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":24},"end":{"row":19,"column":25}},"text":"X"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":25},"end":{"row":19,"column":26}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":20,"column":0},"end":{"row":21,"column":0}},"nl":"\n","lines":["  EX2, EX = X.moment(2), X.moment(1)"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":48}},"text":"  return (1 + CoeffVar**2)/2 * EW_MMc(ar, EX, c)"},{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":21,"column":0}},"nl":"\n","lines":["def EW_MGc_(ar, c, EX, EX2):","  CoeffVar = math.sqrt(EX2 - EX**2)/EX"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":20,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":20,"column":0}},"nl":"\n","lines":[""]}]}]],"redo":[]},"/learn_wmpi.py":{"scrollTop":604.5,"scrollLeft":0,"selection":{"start":{"row":48,"column":42},"end":{"row":48,"column":42}},"lastUse":1542940746349,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":172,"column":34},"end":{"row":172,"column":35}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":157,"column":8},"end":{"row":157,"column":9}},"text":"5"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":157,"column":8},"end":{"row":157,"column":9}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":192,"column":2},"end":{"row":192,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":6},"end":{"row":124,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":124,"column":0},"end":{"row":124,"column":6}},"text":"      "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":6},"end":{"row":123,"column":12}},"text":"refine"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":6},"end":{"row":123,"column":7}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":7},"end":{"row":123,"column":8}},"text":"c"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":8},"end":{"row":123,"column":9}},"text":"h"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":9},"end":{"row":123,"column":10}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":10},"end":{"row":123,"column":11}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":11},"end":{"row":123,"column":12}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":18},"end":{"row":123,"column":19}},"text":"("}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":19},"end":{"row":123,"column":20}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":123,"column":12},"end":{"row":123,"column":29}},"text":"learner.explorer."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":179,"column":2},"end":{"row":179,"column":4}},"text":"# "},{"action":"removeText","range":{"start":{"row":180,"column":2},"end":{"row":180,"column":4}},"text":"# "},{"action":"removeText","range":{"start":{"row":181,"column":2},"end":{"row":181,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":182,"column":2},"end":{"row":182,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":193,"column":2},"end":{"row":193,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":179,"column":2},"end":{"row":179,"column":4}},"text":"# "},{"action":"insertText","range":{"start":{"row":180,"column":2},"end":{"row":180,"column":4}},"text":"# "},{"action":"insertText","range":{"start":{"row":181,"column":2},"end":{"row":181,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":182,"column":2},"end":{"row":182,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":182,"column":2},"end":{"row":182,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":179,"column":2},"end":{"row":179,"column":4}},"text":"# "},{"action":"removeText","range":{"start":{"row":180,"column":2},"end":{"row":180,"column":4}},"text":"# "},{"action":"removeText","range":{"start":{"row":181,"column":2},"end":{"row":181,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":52},"end":{"row":181,"column":53}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":53},"end":{"row":181,"column":54}},"text":"0"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":54},"end":{"row":181,"column":55}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":181,"column":31},"end":{"row":181,"column":32}},"text":"6"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":31},"end":{"row":181,"column":32}},"text":"3"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":27},"end":{"row":181,"column":32}},"text":"10**3"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":32},"end":{"row":181,"column":33}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":33},"end":{"row":181,"column":34}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":34},"end":{"row":181,"column":35}},"text":"0"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":35},"end":{"row":181,"column":36}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":181,"column":26},"end":{"row":181,"column":27}},"text":"*"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":181,"column":25},"end":{"row":181,"column":26}},"text":"0"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":181,"column":24},"end":{"row":181,"column":25}},"text":"0"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":181,"column":23},"end":{"row":181,"column":24}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":181,"column":27},"end":{"row":181,"column":28}},"text":"3"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":181,"column":27},"end":{"row":181,"column":28}},"text":"2"}]}]],"redo":[]},"/plot_data.txt":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":19,"column":19},"end":{"row":19,"column":19}},"lastUse":1542939304578,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":31}},"text":"# ### Plot data for paper ### #"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":31},"end":{"row":1,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":39}},"text":"approx_ET_w_MGc_l: [22.854545454545462,"},{"action":"insertText","range":{"start":{"row":2,"column":39},"end":{"row":3,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":3,"column":0},"end":{"row":34,"column":0}},"lines":["22.854545454545462,","20.2940837649892,","19.542899998772576,","20.343825465135737,","23.127532573083386,","25.610502487224572,","26.802716692467396,","27.232555650994655,","27.369978180066298,","27.411876770020932]"," sim_ET: [22.338746275232392,","22.334920786295687,","20.766050960997774,","19.70642430256996,","18.707752983103809,","20.218050927736122,","23.939757211821206,","24.826275449577366,","32.542441412598869,","27.912796796541631,","28.043551018298075]"," ET_w_MGc_l: [22.363684425944346,","22.363684425944346,","19.651494749474448,","18.487318571401438,","18.310068516675397,","19.416396814241629,","21.884639267283315,","21.552104543494885,","21.490342677765518,","21.478455847091077,"]},{"action":"insertText","range":{"start":{"row":34,"column":0},"end":{"row":34,"column":19}},"text":"21.476152612409624]"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":7},"end":{"row":13,"column":8}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":8},"end":{"row":13,"column":9}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":0},"end":{"row":1,"column":35}},"text":"sinfo_m: {'ar': 1.8300000000000001,"},{"action":"insertText","range":{"start":{"row":1,"column":35},"end":{"row":2,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":2,"column":0},"end":{"row":10,"column":0}},"lines":["'k_rv': BZipf([1, 3], tail index= 1),","'lifetime_rv': Pareto(loc= 10, a= 4),","'njob': 50000,","'nworker': 10,","'reqed_rv': Uniform[1, 1],","'straggle_m': {'slowdown': <function plot_ET_wrt_d.<locals>.<lambda> at 0x7f630f75ec80>},","'wcap': 10}"," mapping_m: {'type': 'spreading'}"]},{"action":"insertText","range":{"start":{"row":10,"column":0},"end":{"row":10,"column":75}},"text":" sching_m: {'r': 2, 'threshold': None, 'type': 'expand_if_totaldemand_leq'}"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":75},"end":{"row":11,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":11,"column":0},"end":{"row":11,"column":1}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":11,"column":0},"end":{"row":11,"column":1}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":19},"end":{"row":45,"column":0}},"text":"\n"}]}]],"redo":[]},"/mrun.sh":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":20,"column":34},"end":{"row":20,"column":34}},"lastUse":1542923823565,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":9},"end":{"row":10,"column":10}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":10},"end":{"row":10,"column":11}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":11},"end":{"row":10,"column":12}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":12},"end":{"row":10,"column":13}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":9},"end":{"row":10,"column":10}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":10},"end":{"row":10,"column":11}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":11},"end":{"row":10,"column":12}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":12},"end":{"row":10,"column":13}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":13},"end":{"row":10,"column":14}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":15},"end":{"row":10,"column":20}},"text":" # 11"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":9},"end":{"row":10,"column":10}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":10},"end":{"row":10,"column":11}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":11},"end":{"row":10,"column":12}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":12},"end":{"row":10,"column":13}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":18},"end":{"row":10,"column":19}},"text":"2"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":17},"end":{"row":10,"column":18}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":16},"end":{"row":10,"column":17}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":15},"end":{"row":10,"column":16}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":12},"end":{"row":10,"column":13}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":11},"end":{"row":10,"column":12}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":10},"end":{"row":10,"column":11}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":9},"end":{"row":10,"column":10}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":18,"column":15},"end":{"row":18,"column":16}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":18,"column":15},"end":{"row":18,"column":16}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":18,"column":16},"end":{"row":18,"column":17}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":18,"column":16},"end":{"row":18,"column":17}},"text":"2"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":18,"column":15},"end":{"row":18,"column":16}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":18,"column":15},"end":{"row":18,"column":16}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":18,"column":36},"end":{"row":18,"column":38}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":18,"column":36},"end":{"row":18,"column":37}},"text":" "}]}]],"redo":[]},"/sim_objs_lessreal.py":{"scrollTop":5531,"scrollLeft":0,"selection":{"start":{"row":298,"column":13},"end":{"row":298,"column":13}},"lastUse":1542922372352,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":40},"end":{"row":268,"column":41}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":41},"end":{"row":268,"column":42}},"text":"f"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":42},"end":{"row":268,"column":43}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":43},"end":{"row":268,"column":44}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":44},"end":{"row":268,"column":45}},"text":"m"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":45},"end":{"row":268,"column":46}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":46},"end":{"row":268,"column":47}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":47},"end":{"row":268,"column":48}},"text":"("}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":48},"end":{"row":268,"column":49}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":49},"end":{"row":268,"column":50}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":48},"end":{"row":268,"column":64}},"text":"wrecvedfrom_id_l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":8},"end":{"row":268,"column":10}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":178,"column":4},"end":{"row":178,"column":6}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":268,"column":8},"end":{"row":268,"column":10}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":268,"column":8},"end":{"row":268,"column":10}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":232,"column":6},"end":{"row":233,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":233,"column":0},"end":{"row":233,"column":6}},"text":"      "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":6},"end":{"row":234,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":234,"column":0},"end":{"row":234,"column":6}},"text":"      "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":6},"end":{"row":233,"column":65}},"text":"log(INFO, \"wrecvedfrom_id_l= {}\".format(wrecvedfrom_id_l) )"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":233,"column":17},"end":{"row":233,"column":33}},"text":"wrecvedfrom_id_l"},{"action":"insertText","range":{"start":{"row":233,"column":17},"end":{"row":233,"column":18}},"text":"j"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":18},"end":{"row":233,"column":19}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":19},"end":{"row":233,"column":20}},"text":"k"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":233,"column":33},"end":{"row":233,"column":49}},"text":"wrecvedfrom_id_l"},{"action":"insertText","range":{"start":{"row":233,"column":33},"end":{"row":233,"column":36}},"text":"j.k"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":6},"end":{"row":233,"column":8}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":234,"column":0},"end":{"row":235,"column":0}},"nl":"\n","lines":["      "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":233,"column":0},"end":{"row":234,"column":0}},"nl":"\n","lines":["      # log(INFO, \"j.k= {}\".format(j.k) )"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":268,"column":0},"end":{"row":269,"column":0}},"nl":"\n","lines":["        # log(INFO, \"wrecvedfrom_id_l= {}\".format(wrecvedfrom_id_l) )"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":178,"column":0},"end":{"row":179,"column":0}},"nl":"\n","lines":["    # log(INFO, \"sl= {}\".format(sl) )"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":177,"column":9},"end":{"row":177,"column":36}},"text":"self.sl(self.sched_load() )"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":177,"column":0},"end":{"row":178,"column":0}},"nl":"\n","lines":["    sl = "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":177,"column":32},"end":{"row":177,"column":34}},"text":"sl"},{"action":"insertText","range":{"start":{"row":177,"column":32},"end":{"row":177,"column":59}},"text":"self.sl(self.sched_load() )"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":236,"column":34},"end":{"row":236,"column":35}},"text":"0"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":236,"column":35},"end":{"row":236,"column":36}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":227,"column":36},"end":{"row":227,"column":37}},"text":"0"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":227,"column":37},"end":{"row":227,"column":38}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":227,"column":37},"end":{"row":227,"column":38}},"text":"0"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":227,"column":36},"end":{"row":227,"column":37}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":315,"column":27},"end":{"row":315,"column":38}},"text":"totaldemand"},{"action":"insertText","range":{"start":{"row":315,"column":27},"end":{"row":315,"column":28}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":28},"end":{"row":315,"column":29}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":29},"end":{"row":315,"column":30}},"text":"q"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":30},"end":{"row":315,"column":31}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":31},"end":{"row":315,"column":32}},"text":"d"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":32},"end":{"row":315,"column":33}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":33},"end":{"row":315,"column":43}},"text":"self.reqed"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":315,"column":33},"end":{"row":315,"column":43}},"text":"self.reqed"},{"action":"insertText","range":{"start":{"row":315,"column":33},"end":{"row":315,"column":34}},"text":"j"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":34},"end":{"row":315,"column":35}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":35},"end":{"row":315,"column":36}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":36},"end":{"row":315,"column":37}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":37},"end":{"row":315,"column":38}},"text":"f"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":38},"end":{"row":315,"column":39}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":39},"end":{"row":315,"column":40}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":40},"end":{"row":315,"column":41}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":41},"end":{"row":315,"column":42}},"text":"m"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":315,"column":42},"end":{"row":315,"column":43}},"text":"e"}]}]],"redo":[]},"/rvs.py":{"scrollTop":13811,"scrollLeft":0,"selection":{"start":{"row":713,"column":2},"end":{"row":713,"column":2}},"lastUse":1542907633681,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":726,"column":52},"end":{"row":726,"column":70}},"text":"sim_EX_given_x_g_x"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":726,"column":70},"end":{"row":726,"column":71}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":726,"column":71},"end":{"row":726,"column":89}},"text":"sim_EX_given_x_g_x"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":726,"column":89},"end":{"row":726,"column":90}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":573,"column":13},"end":{"row":573,"column":15}},"text":"EX"},{"action":"insertText","range":{"start":{"row":573,"column":13},"end":{"row":573,"column":16}},"text":"EXi"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":581,"column":13},"end":{"row":581,"column":15}},"text":"EX"},{"action":"insertText","range":{"start":{"row":581,"column":13},"end":{"row":581,"column":16}},"text":"EXi"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":582,"column":12},"end":{"row":582,"column":14}},"text":"EX"},{"action":"insertText","range":{"start":{"row":582,"column":12},"end":{"row":582,"column":15}},"text":"EXi"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":6},"end":{"row":715,"column":7}},"text":"E"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":7},"end":{"row":715,"column":8}},"text":"x"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":8},"end":{"row":715,"column":9}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":9},"end":{"row":715,"column":10}},"text":"("}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":10},"end":{"row":715,"column":11}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":11},"end":{"row":715,"column":12}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":12},"end":{"row":715,"column":13}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":13},"end":{"row":715,"column":14}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":10},"end":{"row":715,"column":11}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":11},"end":{"row":715,"column":12}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":12},"end":{"row":715,"column":13}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":13},"end":{"row":715,"column":14}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":14},"end":{"row":715,"column":15}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":728,"column":23},"end":{"row":728,"column":24}},"text":"0"},{"action":"insertText","range":{"start":{"row":728,"column":23},"end":{"row":728,"column":24}},"text":"X"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":24},"end":{"row":728,"column":25}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":25},"end":{"row":728,"column":26}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":26},"end":{"row":728,"column":27}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":27},"end":{"row":728,"column":28}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":728,"column":30},"end":{"row":728,"column":33}},"text":"400"},{"action":"insertText","range":{"start":{"row":728,"column":30},"end":{"row":728,"column":31}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":31},"end":{"row":728,"column":32}},"text":"0"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":32},"end":{"row":728,"column":33}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":33},"end":{"row":728,"column":38}},"text":"X.l_l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":728,"column":40},"end":{"row":728,"column":41}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":728,"column":40},"end":{"row":728,"column":41}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":10},"end":{"row":715,"column":11}},"text":"0"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":715,"column":11},"end":{"row":715,"column":12}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":566,"column":48},"end":{"row":566,"column":49}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":566,"column":48},"end":{"row":566,"column":49}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":723,"column":71},"end":{"row":723,"column":72}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":723,"column":71},"end":{"row":723,"column":72}},"text":"5"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":724,"column":70},"end":{"row":724,"column":71}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":724,"column":70},"end":{"row":724,"column":71}},"text":"5"}]}]],"redo":[]},"/w_queues/scher.py":{"scrollTop":3225.5,"scrollLeft":0,"selection":{"start":{"row":182,"column":0},"end":{"row":182,"column":0}},"lastUse":1542858025270,"undo":[],"redo":[]},"/sim_exp.py":{"scrollTop":440,"scrollLeft":0,"selection":{"start":{"row":22,"column":28},"end":{"row":22,"column":28}},"lastUse":1542857640191,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":23},"end":{"row":76,"column":24}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":43,"column":5},"end":{"row":43,"column":9}},"text":"util"},{"action":"insertText","range":{"start":{"row":43,"column":5},"end":{"row":43,"column":6}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":43,"column":6},"end":{"row":43,"column":7}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":43,"column":7},"end":{"row":43,"column":8}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":43,"column":8},"end":{"row":43,"column":9}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":12},"end":{"row":27,"column":13}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":13},"end":{"row":27,"column":14}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":14},"end":{"row":27,"column":15}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":15},"end":{"row":27,"column":16}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":16},"end":{"row":27,"column":17}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":17},"end":{"row":27,"column":18}},"text":"v"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":18},"end":{"row":27,"column":19}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":19},"end":{"row":27,"column":20}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":20},"end":{"row":27,"column":21}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":21},"end":{"row":27,"column":22}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":22},"end":{"row":27,"column":23}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":28},"end":{"row":42,"column":29}},"text":"n"},{"action":"removeText","range":{"start":{"row":41,"column":30},"end":{"row":41,"column":31}},"text":"n"},{"action":"removeText","range":{"start":{"row":35,"column":15},"end":{"row":35,"column":16}},"text":"n"},{"action":"removeText","range":{"start":{"row":27,"column":9},"end":{"row":27,"column":10}},"text":"n"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":27},"end":{"row":42,"column":28}},"text":"w"},{"action":"removeText","range":{"start":{"row":41,"column":29},"end":{"row":41,"column":30}},"text":"w"},{"action":"removeText","range":{"start":{"row":35,"column":14},"end":{"row":35,"column":15}},"text":"w"},{"action":"removeText","range":{"start":{"row":27,"column":8},"end":{"row":27,"column":9}},"text":"w"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":26},"end":{"row":42,"column":27}},"text":"o"},{"action":"removeText","range":{"start":{"row":41,"column":28},"end":{"row":41,"column":29}},"text":"o"},{"action":"removeText","range":{"start":{"row":35,"column":13},"end":{"row":35,"column":14}},"text":"o"},{"action":"removeText","range":{"start":{"row":27,"column":7},"end":{"row":27,"column":8}},"text":"o"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":25},"end":{"row":42,"column":26}},"text":"d"},{"action":"removeText","range":{"start":{"row":41,"column":27},"end":{"row":41,"column":28}},"text":"d"},{"action":"removeText","range":{"start":{"row":35,"column":12},"end":{"row":35,"column":13}},"text":"d"},{"action":"removeText","range":{"start":{"row":27,"column":6},"end":{"row":27,"column":7}},"text":"d"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":24},"end":{"row":42,"column":25}},"text":"w"},{"action":"removeText","range":{"start":{"row":41,"column":26},"end":{"row":41,"column":27}},"text":"w"},{"action":"removeText","range":{"start":{"row":35,"column":11},"end":{"row":35,"column":12}},"text":"w"},{"action":"removeText","range":{"start":{"row":27,"column":5},"end":{"row":27,"column":6}},"text":"w"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":42,"column":23},"end":{"row":42,"column":24}},"text":"o"},{"action":"removeText","range":{"start":{"row":41,"column":25},"end":{"row":41,"column":26}},"text":"o"},{"action":"removeText","range":{"start":{"row":35,"column":10},"end":{"row":35,"column":11}},"text":"o"},{"action":"removeText","range":{"start":{"row":27,"column":4},"end":{"row":27,"column":5}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":22},"end":{"row":27,"column":23}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":23},"end":{"row":27,"column":24}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":24},"end":{"row":27,"column":25}},"text":"["}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":27,"column":25},"end":{"row":27,"column":26}},"text":"]"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":34,"column":30},"end":{"row":35,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":35,"column":0},"end":{"row":35,"column":8}},"text":"        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":8},"end":{"row":35,"column":17}},"text":"serv_sl_l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":17},"end":{"row":35,"column":18}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":18},"end":{"row":35,"column":19}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":19},"end":{"row":35,"column":20}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":20},"end":{"row":35,"column":21}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":21},"end":{"row":35,"column":22}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":22},"end":{"row":35,"column":23}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":23},"end":{"row":35,"column":24}},"text":"d"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":24},"end":{"row":35,"column":25}},"text":"("}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":25},"end":{"row":35,"column":26}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":25},"end":{"row":35,"column":90}},"text":"(info['wait_time'] + info['run_time'] )/info['expected_run_time']"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":35,"column":90},"end":{"row":35,"column":91}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":35,"column":25},"end":{"row":35,"column":46}},"text":"(info['wait_time'] + "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":35,"column":42},"end":{"row":35,"column":43}},"text":")"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":35,"column":41},"end":{"row":35,"column":42}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":43,"column":27},"end":{"row":44,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":44,"column":0},"end":{"row":44,"column":4}},"text":"    "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":4},"end":{"row":44,"column":5}},"text":"'"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":5},"end":{"row":44,"column":6}},"text":"'"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":5},"end":{"row":44,"column":6}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":6},"end":{"row":44,"column":7}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":7},"end":{"row":44,"column":8}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":8},"end":{"row":44,"column":9}},"text":"v"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":9},"end":{"row":44,"column":10}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":10},"end":{"row":44,"column":11}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":11},"end":{"row":44,"column":12}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":12},"end":{"row":44,"column":13}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":13},"end":{"row":44,"column":14}},"text":"m"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":14},"end":{"row":44,"column":15}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":15},"end":{"row":44,"column":16}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":16},"end":{"row":44,"column":17}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":18},"end":{"row":44,"column":19}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":19},"end":{"row":44,"column":20}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":20},"end":{"row":44,"column":29}},"text":"serv_sl_l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":20},"end":{"row":44,"column":21}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":21},"end":{"row":44,"column":22}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":22},"end":{"row":44,"column":23}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":23},"end":{"row":44,"column":24}},"text":"m"},{"action":"insertText","range":{"start":{"row":44,"column":24},"end":{"row":44,"column":25}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":25},"end":{"row":44,"column":26}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":26},"end":{"row":44,"column":27}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":44,"column":26},"end":{"row":44,"column":27}},"text":"a"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":44,"column":25},"end":{"row":44,"column":26}},"text":"e"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":44,"column":24},"end":{"row":44,"column":25}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":24},"end":{"row":44,"column":25}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":25},"end":{"row":44,"column":26}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":26},"end":{"row":44,"column":27}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":27},"end":{"row":44,"column":28}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":37},"end":{"row":44,"column":38}},"text":")"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":44,"column":38},"end":{"row":44,"column":39}},"text":","}]}]],"redo":[]},"/srun.sh":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":9,"column":0},"end":{"row":9,"column":0}},"lastUse":1542729062962,"undo":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":4,"column":81},"end":{"row":4,"column":82}},"text":"3"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":81},"end":{"row":4,"column":82}},"text":"1"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":4,"column":82},"end":{"row":4,"column":83}},"text":"2"}]}]],"redo":[]},"/sim_objs.py":{"scrollTop":364,"scrollLeft":0,"selection":{"start":{"row":52,"column":4},"end":{"row":52,"column":4}},"lastUse":1542645333384,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":304,"column":10},"end":{"row":304,"column":12}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":301,"column":0},"end":{"row":302,"column":0}},"nl":"\n","lines":["        # print(\"job completed, jid= {}\".format(t.jid) )"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":22},"end":{"row":3,"column":23}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":22},"end":{"row":3,"column":27}},"text":"Scher"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":27},"end":{"row":3,"column":28}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":28},"end":{"row":3,"column":29}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":29},"end":{"row":3,"column":36}},"text":"RLScher"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":0},"end":{"row":3,"column":2}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":3,"column":0},"end":{"row":4,"column":0}},"nl":"\n","lines":["# from scheduler import Scher, RLScher"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":0,"column":0},"end":{"row":309,"column":0}},"nl":"\n","lines":["import math, random, simpy, pprint","from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    if len(self.store.items) >= 1000:","      # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","      return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]},{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":34}},"text":"import math, random, simpy, pprint"},{"action":"insertText","range":{"start":{"row":0,"column":34},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":309,"column":0}},"lines":["from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    # if len(self.store.items) >= 1000:","    #   # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","    #   return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":0,"column":0},"end":{"row":309,"column":0}},"nl":"\n","lines":["import math, random, simpy, pprint","from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    # if len(self.store.items) >= 1000:","    #   # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","    #   return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]},{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":34}},"text":"import math, random, simpy, pprint"},{"action":"insertText","range":{"start":{"row":0,"column":34},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":309,"column":0}},"lines":["from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    if len(self.store.items) >= 1000:","      # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","      return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":0,"column":0},"end":{"row":309,"column":0}},"nl":"\n","lines":["import math, random, simpy, pprint","from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    if len(self.store.items) >= 1000:","      # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","      return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]},{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":34}},"text":"import math, random, simpy, pprint"},{"action":"insertText","range":{"start":{"row":0,"column":34},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":309,"column":0}},"lines":["from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    # if len(self.store.items) >= 1000:","    #   # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","    #   return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":0,"column":0},"end":{"row":309,"column":0}},"nl":"\n","lines":["import math, random, simpy, pprint","from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    # if len(self.store.items) >= 1000:","    #   # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","    #   return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]},{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":34}},"text":"import math, random, simpy, pprint"},{"action":"insertText","range":{"start":{"row":0,"column":34},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":309,"column":0}},"lines":["from operator import itemgetter","","from rvs import *","from log_utils import *","","# #######################################  Task  ######################################## #","class Task(object):","  def __init__(self, _id, jid, reqed, demandperslot_rv, totaldemand, k, type_=None):","    self._id = _id","    self.jid = jid","    self.reqed = reqed","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    self.k = k","    self.type_ = type_ # 's': systematic, 'r': redundant","    ","    self.demandperslot_rv_mean = demandperslot_rv.mean()","    ","    self.prev_hop_id = None","    self.binding_time = None","    self.run_time = None","    ","    self.cum_supply = 0","    self.cum_demand = 0","  ","  def __repr__(self):","    return \"Task[id= {}, jid= {}, type= {}]\".format(self._id, self.jid, self.type_)","  ","  def gen_demand(self):","    # d = min(self.demandperslot_rv.sample(), self.totaldemand - self.cum_demand)","    d = min(self.demandperslot_rv_mean, self.totaldemand - self.cum_demand)","    self.cum_demand += d","    return d","  ","  def take_supply(self, s):","    s_ = min(self.cum_demand - self.cum_supply, s)","    self.cum_supply += s_","    return s_","","class Job(object):","  def __init__(self, _id, k, n, demandperslot_rv, totaldemand):","    self._id = _id","    self.k = k","    self.n = n","    self.demandperslot_rv = demandperslot_rv","    self.totaldemand = totaldemand","    ","    self.reqed = self.demandperslot_rv.mean()","  ","  def __repr__(self):","    # return \"Job[id= {}]\".format(self._id)","    return \"Job[id= {}, k= {}, totaldemand= {}, reqed= {}]\".format(self._id, self.k, self.totaldemand, self.reqed)","","class JobGen(object):","  def __init__(self, env, ar, demandperslot_mean_rv, totaldemand_rv, k_rv, njob, out, **kwargs):","    self.env = env","    self.ar = ar","    self.demandperslot_mean_rv = demandperslot_mean_rv","    self.totaldemand_rv = totaldemand_rv","    self.k_rv = k_rv","    self.njob = njob","    self.out = out","    ","    self.nsent = 0","    ","    self.action = self.env.process(self.run_poisson() )","  ","  def run_poisson(self):","    while 1:","      yield self.env.timeout(random.expovariate(self.ar) )","      self.nsent += 1","      k = self.k_rv.sample()","      demandmean = self.demandperslot_mean_rv.sample()","      coeff_var = 0.7","      self.out.put(Job(","        _id = self.nsent,","        k = k, n = k,","        demandperslot_rv = TNormal(demandmean, demandmean*coeff_var),","        totaldemand = self.totaldemand_rv.sample() ) )","      ","      # if self.nsent >= self.njob:","      #   return","","# #########################################  Worker  ############################################# #","class Worker(object):","  def __init__(self, env, _id, cap, out_c, straggle_m):","    self.env = env","    self._id = _id","    self.cap = cap","    self.out_c = out_c","    self.straggle_m = straggle_m","    ","    self.cap_ = self.cap","    ","    self.timeslot = 1","    self.t_l = []","    env.process(self.run() )","    env.process(self.straggle() )","    ","    self.ntimeslots = 0","    self.avg_load = 0","  ","  def straggle(self):","    sl = self.straggle_m['slowdown']","    straggle_dur_rv = self.straggle_m['straggle_dur_rv']","    normal_dur_v = self.straggle_m['normal_dur_rv']","    while True:","      self.cap_ = self.cap*sl(self.sched_load() )","      yield (self.env.timeout(straggle_dur_rv.sample() ) )","      self.cap_ = self.cap","      yield (self.env.timeout(normal_dur_v.sample() ) )","  ","  def __repr__(self):","    return \"Worker[id= {}]\".format(self._id)","  ","  def sched_cap(self):","    if len(self.t_l) == 0:","      return 0","    return sum([t.reqed for t in self.t_l] )","  ","  def nonsched_cap(self):","    return self.cap - self.sched_cap()","  ","  def sched_load(self):","    return self.sched_cap()/self.cap","  ","  def update_avg_load(self, load):","    self.avg_load = (self.avg_load*(self.ntimeslots-1) + load)/self.ntimeslots","  ","  def run(self):","    while True:","      yield (self.env.timeout(self.timeslot) )","      self.ntimeslots += 1","      if len(self.t_l) == 0:","        self.update_avg_load(0)","        continue","      ","      for p in self.t_l:","        p.gen_demand()","      ","      # CPU scheduling","      cap_ = self.cap_","      sched_cap = self.sched_cap()","      total_supplytaken = 0","      for t in self.t_l:","        total_supplytaken += t.take_supply(min(t.reqed, t.reqed/sched_cap*cap_) )","      ","      t_l_ = self.t_l","      while cap_ - total_supplytaken > 0.01:","        t_l_ = [t for t in t_l_ if t.cum_demand - t.cum_supply > 0.01]","        if len(t_l_) == 0:","          break","        ","        supply_foreach = (cap_ - total_supplytaken)/len(t_l_)","        for t in t_l_:","          total_supplytaken += t.take_supply(supply_foreach)","      self.update_avg_load(self.sched_load() )","      # Check if a task is finished","      t_l_ = []","      for t in self.t_l:","        if t.cum_supply - t.totaldemand > -0.01:","          t.run_time = self.env.now - t.binding_time","          t.prev_hop_id = self._id","          self.out_c.put_c(t)","          slog(DEBUG, self.env, self, \"finished\", t)","        else:","          t_l_.append(t)","      self.t_l = t_l_","  ","  def put(self, t):","    avail_cap = self.nonsched_cap()","    if t.type_ == 's' and t.reqed > avail_cap:","      tred_l = [t for t in self.t_l if t.type_ == 'r']","      i = 0","      while i < len(tred_l) and avail_cap < t.reqed:","        tred = tred_l[i]","        avail_cap += tred.reqed","        self.t_l.remove(tred)","        i += 1","      if avail_cap < t.reqed:","        slog(ERROR, self.env, self, \"could not bind\", t)","        return","    elif t.type_ == 'r' and t.reqed > avail_cap:","      return","    ","    t.binding_time = self.env.now","    self.t_l.append(t)","    slog(DEBUG, self.env, self, \"binded, njob= {}\".format(len(self.t_l) ), t)","  ","  def put_c(self, m):","    slog(DEBUG, self.env, self, \"received\", m)","    ","    if m['message'] == 'remove':","      jid = m['jid']","      ti = None","      for i, t in enumerate(self.t_l):","        if t.jid == jid:","          ti = i","      if ti is not None:","        slog(DEBUG, self.env, self, \"removing\", self.t_l[ti] )","        del self.t_l[ti]","    else:","      log(ERROR, \"Unrecognized message;\", m=m)","","# #########################################  Cluster  ############################################ #","class Cluster(object):","  def __init__(self, env, njob, nworker, wcap, straggle_m, scher, **kwargs):","    self.env = env","    self.njob = njob","    self.nworker = nworker","    self.wcap = wcap","    self.straggle_m = straggle_m","    self.scher = scher","    ","    self.w_l = [Worker(env, i, wcap, self, straggle_m) for i in range(nworker) ]","    ","    self.store = simpy.Store(env)","    env.process(self.run() )","    ","    self.njob_finished = 0","    self.store_c = simpy.Store(env)","    self.wait_for_alljobs = env.process(self.run_c() )","    ","    self.jid__t_l_m = {}","    self.jid_info_m = {}","    ","  def __repr__(self):","    # return 'Cluster[' + '\\n' + \\","    #       '\\t njob= {}'.format(self.njob) + '\\n' + \\","    #       '\\t nworker= {}'.format(self.nworker) + '\\n' + \\","    #       '\\t wcap= {}'.format(self.wcap) + '\\n' + \\","    #       '\\t straggle_m= {}'.format(self.straggle_m) + '\\n' + \\","    #       '\\t scher= {}'.format(self.scher)","    return 'Cluster'","  ","  def run(self):","    while True:","      j = yield self.store.get()","      ","      while True:","        s, a, w_l = self.scher.schedule(j, self.w_l, self)","        if a == -1:","          slog(DEBUG, self.env, self, \"a = -1\", j)","          yield self.env.timeout(0.1)","        else:","          break","      # self.store.put(j)","      # self.jid_info_m[j._id] = {'fate': 'dropped'}","      ","      self.jid_info_m[j._id] = {'wait_time': self.env.now - j.arrival_time}","      wid_l = []","      for i, w in enumerate(w_l):","        type_ = 's' if i+1 <= j.k else 'r'","        w.put(Task(i+1, j._id, j.reqed, j.demandperslot_rv, j.totaldemand, j.k, type_) )","        wid_l.append(w._id)","      ","      self.jid__t_l_m[j._id] = []","      self.jid_info_m[j._id].update({","        'expected_run_time': j.totaldemand/j.demandperslot_rv.mean(),","        'wid_l': wid_l,","        's': s, 'a': a} )","  ","  def put(self, j):","    slog(DEBUG, self.env, self, \"received\", j)","    # if len(self.store.items) >= 1000:","    #   # slog(WARNING, self.env, self, \">= 1000 tasks are in q! dropping.\", j)","    #   return","    j.arrival_time = self.env.now","    return self.store.put(j)","  ","  def run_c(self):","    while True:","      t = yield self.store_c.get()","      try:","        self.jid__t_l_m[t.jid].append(t)","      except KeyError: # may happen due to a task completion after the corresponding job finishes","        continue","      ","      t_l = self.jid__t_l_m[t.jid]","      if len(t_l) > t.k:","        log(ERROR, \"len(t_l)= {} > k= {}\".format(len(t_l), t.k) )","      elif len(t_l) < t.k:","        continue","      else:","        t_l = self.jid__t_l_m[t.jid]","        wrecvedfrom_id_l = [t.prev_hop_id for t in t_l]","        wsentto_id_l = self.jid_info_m[t.jid]['wid_l']","        for w in self.w_l:","          if w._id in wsentto_id_l and w._id not in wrecvedfrom_id_l:","            w.put_c({'message': 'remove', 'jid': t.jid} )","        ","        self.jid_info_m[t.jid].update({","          'fate': 'finished',","          'run_time': max([t.run_time for t in self.jid__t_l_m[t.jid] ] ) } )","        self.jid__t_l_m.pop(t.jid, None)","        slog(DEBUG, self.env, self, \"finished jid= {}\".format(t.jid), t)","        ","        ## This causes (s1, a1, r1), (s2, a2, r2) to be interleaved by more than one job","        # self.njob_finished += 1","        if t.jid <= self.njob:","          self.njob_finished += 1","          # log(WARNING, \"job completion;\", jid=t.jid, njob=self.njob, njob_finished=self.njob_finished)","          if self.njob_finished >= self.njob:","            return","  ","  def put_c(self, t):","    slog(DEBUG, self.env, self, \"received\", t)","    return self.store_c.put(t)"]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":129,"column":2},"end":{"row":130,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":130,"column":0},"end":{"row":130,"column":2}},"text":"  "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":2},"end":{"row":131,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":131,"column":0},"end":{"row":131,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":2},"end":{"row":130,"column":3}},"text":"d"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":3},"end":{"row":130,"column":4}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":4},"end":{"row":130,"column":5}},"text":"f"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":5},"end":{"row":130,"column":6}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":6},"end":{"row":130,"column":7}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":7},"end":{"row":130,"column":8}},"text":"v"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":8},"end":{"row":130,"column":9}},"text":"g"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":9},"end":{"row":130,"column":10}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":10},"end":{"row":130,"column":11}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":11},"end":{"row":130,"column":12}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":12},"end":{"row":130,"column":13}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":13},"end":{"row":130,"column":14}},"text":"d"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":14},"end":{"row":130,"column":15}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":15},"end":{"row":130,"column":16}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":15},"end":{"row":130,"column":16}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":16},"end":{"row":130,"column":17}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":17},"end":{"row":130,"column":18}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":18},"end":{"row":130,"column":19}},"text":"f"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":20},"end":{"row":130,"column":21}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":130,"column":21},"end":{"row":131,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":131,"column":0},"end":{"row":131,"column":4}},"text":"    "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":4},"end":{"row":131,"column":5}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":5},"end":{"row":131,"column":6}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":6},"end":{"row":131,"column":7}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":7},"end":{"row":131,"column":8}},"text":"u"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":8},"end":{"row":131,"column":9}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":9},"end":{"row":131,"column":10}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":10},"end":{"row":131,"column":11}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":11},"end":{"row":131,"column":12}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":12},"end":{"row":131,"column":13}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":13},"end":{"row":131,"column":14}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":14},"end":{"row":131,"column":15}},"text":"f"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":15},"end":{"row":131,"column":16}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":16},"end":{"row":131,"column":24}},"text":"avg_load"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":25},"end":{"row":256,"column":26}},"text":"1"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":24},"end":{"row":256,"column":25}},"text":"+"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":256,"column":26},"end":{"row":256,"column":27}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":131,"column":16},"end":{"row":131,"column":17}},"text":"_"},{"action":"insertText","range":{"start":{"row":128,"column":26},"end":{"row":128,"column":27}},"text":"_"},{"action":"insertText","range":{"start":{"row":128,"column":9},"end":{"row":128,"column":10}},"text":"_"},{"action":"insertText","range":{"start":{"row":101,"column":9},"end":{"row":101,"column":10}},"text":"_"}]}]],"redo":[]},"/mapper.py":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":15,"column":39},"end":{"row":15,"column":39}},"lastUse":1542485402030,"undo":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":13,"column":30},"end":{"row":13,"column":31}},"text":"n"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":13,"column":29},"end":{"row":13,"column":30}},"text":"\\"}]}]],"redo":[]},"/scheduler.py":{"scrollTop":5.5,"scrollLeft":0,"selection":{"start":{"row":24,"column":21},"end":{"row":24,"column":21}},"lastUse":1542473088926,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":17},"end":{"row":77,"column":18}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":20},"end":{"row":77,"column":32}},"text":", len(w_l) )"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":78,"column":0},"end":{"row":79,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":20},"end":{"row":79,"column":21}},"text":"k"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":20},"end":{"row":79,"column":21}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":81,"column":0},"end":{"row":82,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":81,"column":0},"end":{"row":82,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":81,"column":0},"end":{"row":82,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":33},"end":{"row":75,"column":34}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":34},"end":{"row":75,"column":35}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":35},"end":{"row":75,"column":36}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":36},"end":{"row":75,"column":37}},"text":"x"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":37},"end":{"row":75,"column":38}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":38},"end":{"row":75,"column":39}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":39},"end":{"row":75,"column":40}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":40},"end":{"row":75,"column":41}},"text":"d"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":41},"end":{"row":75,"column":42}},"text":"="}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":42},"end":{"row":75,"column":43}},"text":"T"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":43},"end":{"row":75,"column":44}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":44},"end":{"row":75,"column":45}},"text":"u"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":45},"end":{"row":75,"column":46}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":26},"end":{"row":76,"column":27}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":27},"end":{"row":76,"column":28}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":28},"end":{"row":76,"column":29}},"text":"f"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":29},"end":{"row":76,"column":30}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":30},"end":{"row":76,"column":31}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":31},"end":{"row":76,"column":32}},"text":"x"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":32},"end":{"row":76,"column":33}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":76,"column":32},"end":{"row":76,"column":33}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":32},"end":{"row":76,"column":33}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":33},"end":{"row":76,"column":34}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":34},"end":{"row":76,"column":35}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":35},"end":{"row":76,"column":36}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":36},"end":{"row":76,"column":37}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":37},"end":{"row":76,"column":38}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":38},"end":{"row":76,"column":39}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":39},"end":{"row":76,"column":40}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":40},"end":{"row":76,"column":41}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":41},"end":{"row":76,"column":42}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":42},"end":{"row":76,"column":43}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":84,"column":21},"end":{"row":84,"column":23}},"text":"j."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":84,"column":23},"end":{"row":84,"column":24}},"text":"k"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":84,"column":24},"end":{"row":84,"column":25}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":85,"column":0},"end":{"row":85,"column":46}},"text":"    return self.plain(j, w_l, cluster, expand)"},{"action":"removeLines","range":{"start":{"row":59,"column":0},"end":{"row":85,"column":0}},"nl":"\n","lines":["# ############################################  Scher  ########################################### #","class Scher_wMultiplicativeExpansion(object):","  def __init__(self, mapping_m, sching_m):","    self.sching_m = sching_m","    self.mapper = Mapper(mapping_m)","    ","    self.s_len = 1","    ","    if sching_m['type'] == 'plain':","      self.schedule = self.plain","    elif sching_m['type'] == 'expand_if_totaldemand_leq':","      self.schedule = self.expand_if_totaldemand_leq","  ","  def __repr__(self):","    return 'Scher_wMultiplicativeExpansion[sching_m={}, mapper= {}]'.format(self.sching_m, self.mapper)","  ","  def plain(self, j, w_l, cluster, expand=True):","    r = self.sching_m['r'] if expand else 1","    j.n = int(j.k*a)","    w_l = self.mapper.worker_l(j, w_l)","    if len(w_l) < j.n:","      return None, -1, None","    return None, a, w_l[:j.n]","  ","  def expand_if_totaldemand_leq(self, j, w_l, cluster):","    expand = True if j.k*j.totaldemand < self.sching_m['threshold'] else False"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":59,"column":0},"end":{"row":60,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":59,"column":0},"end":{"row":60,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":75,"column":72},"end":{"row":75,"column":73}},"text":"5"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":72},"end":{"row":75,"column":73}},"text":"1"}]}]],"redo":[]},"/log_utils.py":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":27,"column":8},"end":{"row":27,"column":8}},"lastUse":1542427046282,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":2}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":8,"column":0},"end":{"row":8,"column":2}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":0},"end":{"row":8,"column":2}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":2}},"text":"# "}]}]],"redo":[]},"/plot_utils.py":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":19,"column":18},"end":{"row":19,"column":18}},"lastUse":1542408450012,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":1},"end":{"row":10,"column":2}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":2},"end":{"row":10,"column":3}},"text":"g"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":3},"end":{"row":10,"column":4}},"text":"h"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":4},"end":{"row":10,"column":5}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":9},"end":{"row":10,"column":10}},"text":"r"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":8},"end":{"row":10,"column":9}},"text":"o"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":7},"end":{"row":10,"column":8}},"text":"l"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":6},"end":{"row":10,"column":7}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":1},"end":{"row":9,"column":2}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":2},"end":{"row":9,"column":3}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":3},"end":{"row":9,"column":4}},"text":"k"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":8},"end":{"row":9,"column":9}},"text":"r"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":7},"end":{"row":9,"column":8}},"text":"o"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":6},"end":{"row":9,"column":7}},"text":"l"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":5},"end":{"row":9,"column":6}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":5},"end":{"row":12,"column":6}},"text":"r"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":4},"end":{"row":12,"column":5}},"text":"e"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":3},"end":{"row":12,"column":4}},"text":"k"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":2},"end":{"row":12,"column":3}},"text":"r"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":1},"end":{"row":12,"column":2}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":13,"column":6},"end":{"row":13,"column":13}},"text":"_marker"},{"action":"insertText","range":{"start":{"row":13,"column":6},"end":{"row":13,"column":7}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":7},"end":{"row":9,"column":11}},"text":"ycle"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":10,"column":8},"end":{"row":10,"column":12}},"text":"ycle"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":11,"column":4},"end":{"row":11,"column":8}},"text":"ycle"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":3},"end":{"row":12,"column":7}},"text":"ycle"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":1},"end":{"row":12,"column":2}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":2},"end":{"row":12,"column":3}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":3},"end":{"row":12,"column":4}},"text":"k"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":4},"end":{"row":12,"column":5}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":12,"column":5},"end":{"row":12,"column":6}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":1},"end":{"row":11,"column":2}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":2},"end":{"row":11,"column":3}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":3},"end":{"row":11,"column":4}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":4},"end":{"row":11,"column":5}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":5},"end":{"row":11,"column":6}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":6},"end":{"row":11,"column":7}},"text":"y"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":7},"end":{"row":11,"column":8}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":11,"column":8},"end":{"row":11,"column":9}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":11,"column":9},"end":{"row":11,"column":10}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":6},"end":{"row":10,"column":7}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":7},"end":{"row":10,"column":8}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":8},"end":{"row":10,"column":9}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":10,"column":9},"end":{"row":10,"column":10}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":5},"end":{"row":9,"column":6}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":6},"end":{"row":9,"column":7}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":7},"end":{"row":9,"column":8}},"text":"o"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":8},"end":{"row":9,"column":9}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":0},"end":{"row":9,"column":0}},"text":"\n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":0},"end":{"row":10,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":9}},"text":"NICE_BLUE"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":9,"column":0},"end":{"row":9,"column":9}},"text":"NICE_BLUE"},{"action":"insertText","range":{"start":{"row":9,"column":0},"end":{"row":10,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":10,"column":0},"end":{"row":15,"column":0}},"lines":["NICE_BLUE = '#66b3ff'","NICE_RED = '#ff9999'","NICE_GREEN = '#99ff99'","NICE_ORANGE = '#ffcc99'",""]},{"action":"insertText","range":{"start":{"row":15,"column":0},"end":{"row":15,"column":82}},"text":"nice_color_cycle = itertools.cycle((NICE_BLUE, NICE_RED, NICE_GREEN, NICE_ORANGE))"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":16,"column":0},"end":{"row":17,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":15,"column":4},"end":{"row":15,"column":5}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":15,"column":11},"end":{"row":15,"column":15}},"text":"ycle"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":9,"column":0},"end":{"row":10,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":42},"end":{"row":20,"column":0}},"text":"\n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":20,"column":0},"end":{"row":21,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":21,"column":0},"end":{"row":21,"column":17}},"text":"def prettify(ax):"},{"action":"insertText","range":{"start":{"row":21,"column":17},"end":{"row":22,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":22,"column":0},"end":{"row":25,"column":0}},"lines":["plot.tick_params(top='off', right='off', which='both')","ax.patch.set_alpha(0.2)","ax.spines['right'].set_visible(False)"]},{"action":"insertText","range":{"start":{"row":25,"column":0},"end":{"row":25,"column":35}},"text":"ax.spines['top'].set_visible(False)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":0},"end":{"row":22,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":23,"column":0},"end":{"row":23,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":24,"column":0},"end":{"row":24,"column":2}},"text":"  "},{"action":"insertText","range":{"start":{"row":25,"column":0},"end":{"row":25,"column":2}},"text":"  "}]}]],"redo":[]},"/q_learning.py":{"scrollTop":4314.5,"scrollLeft":0,"selection":{"start":{"row":274,"column":70},"end":{"row":274,"column":70}},"lastUse":1542295919681,"undo":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":65,"column":24},"end":{"row":65,"column":25}},"text":"r"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":65,"column":23},"end":{"row":65,"column":24}},"text":"e"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":65,"column":22},"end":{"row":65,"column":23}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":22},"end":{"row":65,"column":23}},"text":"c"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":23},"end":{"row":65,"column":24}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":65,"column":23},"end":{"row":65,"column":24}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":23},"end":{"row":65,"column":24}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":24},"end":{"row":65,"column":25}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":25},"end":{"row":65,"column":26}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":26},"end":{"row":65,"column":27}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":27},"end":{"row":65,"column":28}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":28},"end":{"row":65,"column":29}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":29},"end":{"row":65,"column":30}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":30},"end":{"row":65,"column":31}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":31},"end":{"row":65,"column":32}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":32},"end":{"row":65,"column":33}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":33},"end":{"row":65,"column":34}},"text":"f"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":34},"end":{"row":65,"column":35}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":52},"end":{"row":65,"column":53}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":53},"end":{"row":65,"column":54}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":30},"end":{"row":65,"column":31}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":31},"end":{"row":65,"column":32}},"text":"p"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":32},"end":{"row":65,"column":33}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":33},"end":{"row":65,"column":34}},"text":"m"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":34},"end":{"row":65,"column":35}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":35},"end":{"row":65,"column":36}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":36},"end":{"row":65,"column":37}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":37},"end":{"row":65,"column":38}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":63},"end":{"row":65,"column":64}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":65,"column":64},"end":{"row":65,"column":65}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":66,"column":0},"end":{"row":67,"column":0}},"nl":"\n","lines":["    pass"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":55,"column":29},"end":{"row":55,"column":30}},"text":"5"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":55,"column":29},"end":{"row":55,"column":30}},"text":"2"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":55,"column":30},"end":{"row":55,"column":31}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":101,"column":19},"end":{"row":101,"column":20}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":101,"column":19},"end":{"row":101,"column":20}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":259,"column":6},"end":{"row":259,"column":8}},"text":"# "},{"action":"insertText","range":{"start":{"row":260,"column":6},"end":{"row":260,"column":8}},"text":"# "},{"action":"insertText","range":{"start":{"row":261,"column":6},"end":{"row":261,"column":8}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":261,"column":90},"end":{"row":262,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":262,"column":0},"end":{"row":262,"column":6}},"text":"      "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":262,"column":6},"end":{"row":262,"column":94}},"text":"hidden1 = tf.contrib.layers.fully_connected(self.s_ph, nn_len, activation_fn=tf.nn.relu)"},{"action":"insertText","range":{"start":{"row":262,"column":94},"end":{"row":263,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":263,"column":0},"end":{"row":264,"column":0}},"lines":["      hidden2 = tf.contrib.layers.fully_connected(hidden1, nn_len, activation_fn=tf.nn.relu)"]},{"action":"insertText","range":{"start":{"row":264,"column":0},"end":{"row":264,"column":88}},"text":"      self.Qa_ph = tf.contrib.layers.fully_connected(hidden2, a_len, activation_fn=None)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":263,"column":92},"end":{"row":264,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":264,"column":0},"end":{"row":264,"column":6}},"text":"      "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":264,"column":6},"end":{"row":264,"column":92}},"text":"hidden2 = tf.contrib.layers.fully_connected(hidden1, nn_len, activation_fn=tf.nn.relu)"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":264,"column":12},"end":{"row":264,"column":13}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":264,"column":12},"end":{"row":264,"column":13}},"text":"3"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":264,"column":56},"end":{"row":264,"column":57}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":264,"column":56},"end":{"row":264,"column":57}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":265,"column":59},"end":{"row":265,"column":60}},"text":"2"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":265,"column":59},"end":{"row":265,"column":60}},"text":"3"}]}]],"redo":[]},"/modeling_w_k.py":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":19,"column":42},"end":{"row":19,"column":42}},"lastUse":1542229822097,"undo":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":32,"column":0},"end":{"row":32,"column":2}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":29,"column":0},"end":{"row":30,"column":0}},"nl":"\n","lines":["if w_cancel and d == 0:"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":34},"end":{"row":28,"column":49}},"text":", w_cancel=True"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":30},"end":{"row":28,"column":34}},"text":"k, c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":19},"end":{"row":28,"column":23}},"text":"k, c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":23},"end":{"row":28,"column":24}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":24},"end":{"row":28,"column":25}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":35},"end":{"row":28,"column":36}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":34},"end":{"row":28,"column":35}},"text":","}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":33},"end":{"row":28,"column":34}},"text":"d"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":32},"end":{"row":28,"column":33}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":31},"end":{"row":28,"column":32}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":29,"column":0},"end":{"row":30,"column":0}},"nl":"\n","lines":["  # log(WARNING, \"loc= {}, a= {}, d= {}, k= {}, c= {}\".format(loc, a, d, k, c) )"]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":0},"end":{"row":29,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":5,"column":0},"end":{"row":6,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":0},"end":{"row":6,"column":2}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":2},"end":{"row":6,"column":3}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":3},"end":{"row":6,"column":4}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":4},"end":{"row":6,"column":5}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":5},"end":{"row":6,"column":6}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":6},"end":{"row":6,"column":7}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":7},"end":{"row":6,"column":8}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":8},"end":{"row":6,"column":9}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":9},"end":{"row":6,"column":10}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":10},"end":{"row":6,"column":11}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":11},"end":{"row":6,"column":12}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":12},"end":{"row":6,"column":13}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":13},"end":{"row":6,"column":14}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":14},"end":{"row":6,"column":15}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":15},"end":{"row":6,"column":16}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":16},"end":{"row":6,"column":17}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":17},"end":{"row":6,"column":18}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":18},"end":{"row":6,"column":19}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":19},"end":{"row":6,"column":20}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":20},"end":{"row":6,"column":21}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":21},"end":{"row":6,"column":22}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":22},"end":{"row":6,"column":23}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":23},"end":{"row":6,"column":24}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":24},"end":{"row":6,"column":25}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":25},"end":{"row":6,"column":26}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":26},"end":{"row":6,"column":27}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":27},"end":{"row":6,"column":28}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":28},"end":{"row":6,"column":29}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":29},"end":{"row":6,"column":30}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":30},"end":{"row":6,"column":31}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":31},"end":{"row":6,"column":32}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":32},"end":{"row":6,"column":33}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":33},"end":{"row":6,"column":34}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":34},"end":{"row":6,"column":35}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":35},"end":{"row":6,"column":36}},"text":"B"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":36},"end":{"row":6,"column":37}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":37},"end":{"row":6,"column":38}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":38},"end":{"row":6,"column":39}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":39},"end":{"row":6,"column":40}},"text":"c"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":40},"end":{"row":6,"column":41}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":41},"end":{"row":6,"column":42}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":42},"end":{"row":6,"column":43}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":43},"end":{"row":6,"column":44}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":44},"end":{"row":6,"column":45}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":45},"end":{"row":6,"column":46}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":46},"end":{"row":6,"column":47}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":47},"end":{"row":6,"column":48}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":48},"end":{"row":6,"column":49}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":49},"end":{"row":6,"column":50}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":50},"end":{"row":6,"column":51}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":51},"end":{"row":6,"column":52}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":52},"end":{"row":6,"column":53}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":53},"end":{"row":6,"column":54}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":54},"end":{"row":6,"column":55}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":55},"end":{"row":6,"column":56}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":56},"end":{"row":6,"column":57}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":57},"end":{"row":6,"column":58}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":58},"end":{"row":6,"column":59}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":59},"end":{"row":6,"column":60}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":60},"end":{"row":6,"column":61}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":61},"end":{"row":6,"column":62}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":62},"end":{"row":6,"column":63}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":33},"end":{"row":6,"column":34}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":34},"end":{"row":6,"column":35}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":35},"end":{"row":6,"column":36}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":36},"end":{"row":6,"column":37}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":37},"end":{"row":6,"column":38}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":38},"end":{"row":6,"column":39}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":69},"end":{"row":6,"column":106}},"text":"#####################################"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":105},"end":{"row":6,"column":106}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":104},"end":{"row":6,"column":105}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":103},"end":{"row":6,"column":104}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":102},"end":{"row":6,"column":103}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":101},"end":{"row":6,"column":102}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":100},"end":{"row":6,"column":101}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":99},"end":{"row":6,"column":100}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":98},"end":{"row":6,"column":99}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":98},"end":{"row":6,"column":99}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":99},"end":{"row":6,"column":100}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":39},"end":{"row":6,"column":40}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":40},"end":{"row":6,"column":41}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":41},"end":{"row":6,"column":42}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":42},"end":{"row":6,"column":43}},"text":"#"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":6,"column":43},"end":{"row":6,"column":44}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":102},"end":{"row":6,"column":103}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":101},"end":{"row":6,"column":102}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":100},"end":{"row":6,"column":101}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":99},"end":{"row":6,"column":100}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":6,"column":98},"end":{"row":6,"column":99}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":46,"column":0},"end":{"row":47,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":47,"column":0},"end":{"row":47,"column":100}},"text":"# ##########################################  Basics  ############################################ #"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":422,"column":0},"end":{"row":422,"column":13}},"text":"    do_for(d)"},{"action":"removeLines","range":{"start":{"row":263,"column":0},"end":{"row":422,"column":0}},"nl":"\n","lines":["def E_slowdown(ar, N, Cap, k, D, S_gen, d=None, r=None):","  ## E[kD | kD <= d] = E[k x E[D | D <= d/k]]","  E_D_given_D_leq_doverk = lambda k: mean(D, given_X_leq_x=True, x=d/k)","  E_D_given_D_g_doverk = lambda k: mean(D, given_X_leq_x=False, x=d/k)","  # E_kD_given_kD_leq_d = float(","  #   mpmath.quad(lambda i: i*E_D_given_D_leq_doverk(i)*k.pdf(i), [0, mpmath.inf] ) )","  ","  if d is not None:","    Pr_kD_leq_d = sum([D.cdf(d/i)*k.pdf(i) for i in k.v_l] )","    blog(Pr_kD_leq_d=Pr_kD_leq_d)","  def ro_(ro):","    S = S_gen(ro)","    if d is not None:","      ES = S.mean()","      ","      ## kD <= d","      def E_cumS(k_):","        E = 0","        for i in range(1, k_+1):","          S_kplusr_i = X_n_k(S, k_+r, i)","          E += (r+1)*S_kplusr_i.mean() if i == k_ else S_kplusr_i.mean()","        return E","      EC_given_kD_leq_d = sum([E_cumS(i)*E_D_given_D_leq_doverk(i)*k.pdf(i) for i in k.v_l] )","      ","      ## kD > d","      EC_given_kD_g_d = ES*sum([i*E_D_given_D_g_doverk(i)*k.pdf(i) for i in k.v_l] )","      ","      # log(INFO, \"d= {}, ro= {}\".format(d, ro), EC_given_kD_leq_d=EC_given_kD_leq_d, EC_given_kD_g_d=EC_given_kD_g_d, Pr_kD_leq_d=Pr_kD_leq_d)","      EA = EC_given_kD_leq_d*Pr_kD_leq_d + \\","           EC_given_kD_g_d*(1 - Pr_kD_leq_d)","    else:","      EA = k.mean()*D.mean()*S.mean()","    return ar/N/Cap * EA","  ","  eq = lambda ro: ro - ro_(ro)","  l, u = 0.0001, 1","  # for x in np.linspace(l, u, 10):","  #   print(\"eq({})= {}\".format(x, eq(x) ) )","  ","  max_eq, u_w_max_eq = float('-inf'), 0","  u_w_max_eq","  eq_u = -1","  while u > l and eq_u < -0.01:","    eq_u = eq(u)","    if eq_u > max_eq:","      max_eq = eq_u","      u_w_max_eq = u","    u -= 0.05","  if u < l:","    print(\"u < l; u_w_max_eq= {}, max_eq= {}\".format(u_w_max_eq, max_eq) )","    found_it = False","    for u in np.linspace(u_w_max_eq-0.05, u_w_max_eq+0.05, 10):","      if eq(u) > -0.01:","        found_it = True","        break","    if not found_it:","      return None","  print(\"l= {}, u= {}\".format(l, u) )","  ","  # eq_l, eq_u = eq(l), eq(u)","  # print(\"eq({})= {}, eq({})= {}\".format(l, eq_l, u, eq_u) )","  # if eq_l*eq_u > 0:","  #   return None","  ","  ro = scipy.optimize.brentq(eq, l, u)","  # ro = scipy.optimize.newton(eq, 1)","  # ro = scipy.optimize.fixed_point(ro_, 0.5)","  # ro = scipy.optimize.fixed_point(ro_, [0.01, 0.99] )","  log(INFO, \"ro= {}\".format(ro), d=d)","  # for x in np.linspace(l, u, 40):","  #   print(\"eq({})= {}\".format(x, eq(x) ) )","  ","  S = S_gen(ro)","  E_S_given_kD_g_d = sum([X_n_k(S, i, i).mean()*k.pdf(i) for i in k.v_l] )","  if d is not None:","    E_S_given_kD_leq_d = sum([X_n_k(S, i+r, i).mean()*k.pdf(i) for i in k.v_l] )","    return E_S_given_kD_leq_d*Pr_kD_leq_d + \\","           E_S_given_kD_g_d*(1 - Pr_kD_leq_d)","  else:","    return E_S_given_kD_g_d","  ","def arrival_rate_ub(N, Cap, k, D, S_gen):","  return N*Cap/k.mean()/D.mean()/S_gen(1).mean()  ","","def arrival_rate_for_load_ro(ro, N, Cap, k, D, S_gen):","  return ro*N*Cap/k.mean()/D.mean()/S_gen(ro).mean()","","def plot_slowdown():","  N, Cap = 10, 100","  D = TPareto(1, 1000, 1) # Pareto(10, 2)","  k = BZipf(1, 10)","  r = 1","  ","  # S_gen = lambda ro: TPareto(1, 40, 2/ro)","  def S_gen(ro):","    # a = 2 - ro # 1.5 - math.sqrt(ro)","    a = 1.1/ro","    if a < 0:","      log(ERROR, \"a= {} < 0!\".format(a), ro=ro)","      a = float(\"inf\")","    return TPareto(1, 100, a)","  ar_ub = arrival_rate_ub(N, Cap, k, D, S_gen)","  print(\"ar_ub= {}\".format(ar_ub) )","  ","  # d = 2*D.mean()","  # for ar in np.linspace(ar_ub/20, ar_ub, 10):","  #   E_sl = E_slowdown(ar, N, Cap, k, D, S_gen)","  #   E_sl_wred = E_slowdown(ar, N, Cap, k, D, S_gen, d, r)","  #   print(\"ar= {}, E_sl= {}, E_sl_wred= {}\".format(ar, E_sl, E_sl_wred) )","  ","  # ar = 1/4*ar_ub # 1/2, 2/3","  ar = arrival_rate_for_load_ro(1/2, N, Cap, k, D, S_gen)","  ","  l, u = 1.1*D.l_l, 0.95*D.u_l","  # for d in np.linspace(l, u, 10):","  E_sl = E_slowdown(ar, N, Cap, k, D, S_gen)","  print(\"E_sl= {}\".format(E_sl) )","  ","  d_l, E_sl_wred_l = [], []","  for d in np.logspace(math.log10(l), math.log10(u), 10):","  # for d in [11, 20]:","  # for d in [l, u]:","    print(\"\\n>> d= {}\".format(d) )","    d_l.append(d)","    ","    E_sl_wred = E_slowdown(ar, N, Cap, k, D, S_gen, d, r)","    blog(E_sl=E_sl, E_sl_wred=E_sl_wred)","    E_sl_wred_l.append(E_sl_wred)","    # if E_sl_wred is None:","    #   break","  ","  plot.axhline(y=E_sl, label=r'w/o red', c=next(darkcolor_c) )","  plot.plot(d_l, E_sl_wred_l, label=r'w/ red', c=next(darkcolor_c), marker=next(marker_c), ls=':', mew=2)","  plot.legend()","  plot.xlabel('d', fontsize=fontsize)","  plot.ylabel('Average slowdown', fontsize=fontsize)","  plot.title('N= {}, Cap= {}, D$\\sim {}$\\n'.format(N, Cap, D.tolatex() ) + 'k$\\sim${}, r= {}'.format(k, r) )","  plot.savefig('plot_slowdown.png')","  plot.gcf().clear()","  log(INFO, \"done.\")","","def test():","  N, Cap = 10, 100","  D = TPareto(1, 1000, 1) # Pareto(10, 2)","  k = BZipf(1, 10)","  ","  def do_for(d):","    E_D_given_D_leq_doverk = lambda k_: mean(D, given_X_leq_x=True, x=d/k_)","    E_D_given_D_g_doverk = lambda k_: mean(D, given_X_leq_x=False, x=d/k_)","    ","    E_kD_given_kD_leq_d = sum([i*E_D_given_D_leq_doverk(i)*k.pdf(i) for i in k.v_l] )","    Pr_kD_leq_d = sum([D.cdf(d/i)*k.pdf(i) for i in k.v_l] )","    E_kD_given_kD_g_d = sum([i*E_D_given_D_g_doverk(i)*k.pdf(i) for i in k.v_l] )","    ","    E_kD = k.mean()*D.mean()","    E_kD_totalsum = Pr_kD_leq_d*E_kD_given_kD_leq_d + (1 - Pr_kD_leq_d)*E_kD_given_kD_g_d","    log(INFO, \"d= {}\".format(d), E_kD=E_kD, E_kD_totalsum=E_kD_totalsum)","  ","  for d in np.linspace(10, 1000, 10):"]}]}]],"redo":[]},"/rlearning.py":{"scrollTop":0,"scrollLeft":0,"selection":{"start":{"row":19,"column":13},"end":{"row":19,"column":13}},"lastUse":1541959265701,"undo":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":26},"end":{"row":28,"column":38}},"text":"cluster_qlen"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":38},"end":{"row":28,"column":39}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":39},"end":{"row":28,"column":40}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":28,"column":40},"end":{"row":28,"column":66}},"text":"min(wload_l), max(wload_l)"},{"action":"insertText","range":{"start":{"row":28,"column":40},"end":{"row":28,"column":73}},"text":"np.mean(wload_l), np.std(wload_l)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":28,"column":73},"end":{"row":28,"column":74}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":28},"end":{"row":75,"column":29}},"text":"("}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":29},"end":{"row":75,"column":30}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":12},"end":{"row":8,"column":13}},"text":"4"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":13},"end":{"row":8,"column":14}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":14},"end":{"row":8,"column":15}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":15},"end":{"row":8,"column":16}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":55},"end":{"row":16,"column":79}},"text":"len(cluster.store.items)"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":54},"end":{"row":16,"column":55}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":53},"end":{"row":16,"column":54}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":27},"end":{"row":16,"column":51}},"text":"len(cluster.store.items)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":51},"end":{"row":16,"column":52}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":52},"end":{"row":16,"column":53}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":81},"end":{"row":17,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":17,"column":0},"end":{"row":17,"column":4}},"text":"    "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":4},"end":{"row":18,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":18,"column":4},"end":{"row":18,"column":37}},"text":"np.mean(wload_l), np.std(wload_l)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":4},"end":{"row":16,"column":6}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":4},"end":{"row":17,"column":81}},"text":"return [j.totaldemand, len(cluster.store.items), min(wload_l), max(wload_l) ]"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":18,"column":4},"end":{"row":18,"column":37}},"text":"np.mean(wload_l), np.std(wload_l)"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":18,"column":0},"end":{"row":19,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":53},"end":{"row":17,"column":79}},"text":"min(wload_l), max(wload_l)"},{"action":"insertText","range":{"start":{"row":17,"column":53},"end":{"row":17,"column":86}},"text":"np.mean(wload_l), np.std(wload_l)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":12},"end":{"row":8,"column":13}},"text":"6"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":13},"end":{"row":8,"column":14}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":14},"end":{"row":8,"column":15}},"text":"#"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":8,"column":15},"end":{"row":8,"column":16}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":8,"column":20},"end":{"row":8,"column":21}},"text":"6"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":8,"column":19},"end":{"row":8,"column":20}},"text":" "}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":8,"column":18},"end":{"row":8,"column":19}},"text":"#"}]},{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":8,"column":17},"end":{"row":8,"column":18}},"text":" "}]}]],"redo":[]},"/w_queues/sim.py":{"scrollTop":122.5,"scrollLeft":0,"selection":{"start":{"row":22,"column":38},"end":{"row":22,"column":38}},"lastUse":1541792559875,"undo":[],"redo":[]},"/experience_replay.py":{"scrollTop":2664.5,"scrollLeft":0,"selection":{"start":{"row":153,"column":29},"end":{"row":153,"column":29}},"lastUse":1541726142849,"undo":[[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":94,"column":0},"end":{"row":95,"column":0}},"nl":"\n","lines":["              "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":95,"column":0},"end":{"row":96,"column":0}},"nl":"\n","lines":["              "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":95,"column":14},"end":{"row":95,"column":31}},"text":"t_sl_l.append(sl)"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":90,"column":93},"end":{"row":91,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":91,"column":0},"end":{"row":91,"column":14}},"text":"              "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":91,"column":14},"end":{"row":91,"column":31}},"text":"t_sl_l.append(sl)"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":97,"column":0},"end":{"row":98,"column":0}},"nl":"\n","lines":["            "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":96,"column":12},"end":{"row":96,"column":14}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":16},"end":{"row":87,"column":17}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":87,"column":16},"end":{"row":87,"column":17}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":16},"end":{"row":87,"column":17}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":17},"end":{"row":87,"column":18}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":18},"end":{"row":87,"column":19}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":26},"end":{"row":87,"column":27}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":27},"end":{"row":87,"column":28}},"text":"i"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":28},"end":{"row":87,"column":29}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":29},"end":{"row":87,"column":30}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":30},"end":{"row":87,"column":31}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":82},"end":{"row":87,"column":83}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":83},"end":{"row":87,"column":84}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":26},"end":{"row":87,"column":27}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":27},"end":{"row":87,"column":28}},"text":"n"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":28},"end":{"row":87,"column":29}},"text":"u"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":29},"end":{"row":87,"column":30}},"text":"m"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":30},"end":{"row":87,"column":31}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":31},"end":{"row":87,"column":32}},"text":"r"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":32},"end":{"row":87,"column":33}},"text":"a"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":33},"end":{"row":87,"column":34}},"text":"t"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":34},"end":{"row":87,"column":35}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":35},"end":{"row":87,"column":36}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":94},"end":{"row":87,"column":95}},"text":" "}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":87,"column":95},"end":{"row":87,"column":96}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":86,"column":47},"end":{"row":86,"column":48}},"text":"1"},{"action":"insertText","range":{"start":{"row":86,"column":47},"end":{"row":86,"column":48}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":48},"end":{"row":86,"column":49}},"text":"e"},{"action":"insertText","range":{"start":{"row":86,"column":49},"end":{"row":86,"column":50}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":50},"end":{"row":86,"column":51}},"text":"f"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":51},"end":{"row":86,"column":52}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":52},"end":{"row":86,"column":53}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":53},"end":{"row":86,"column":54}},"text":"c"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":54},"end":{"row":86,"column":55}},"text":"h"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":55},"end":{"row":86,"column":56}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":56},"end":{"row":86,"column":57}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":57},"end":{"row":86,"column":58}},"text":"."}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":58},"end":{"row":86,"column":59}},"text":"s"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":59},"end":{"row":86,"column":60}},"text":"_"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":60},"end":{"row":86,"column":61}},"text":"l"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":61},"end":{"row":86,"column":62}},"text":"e"}]},{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":86,"column":62},"end":{"row":86,"column":63}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":93,"column":23},"end":{"row":93,"column":24}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":93,"column":23},"end":{"row":93,"column":24}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":94,"column":23},"end":{"row":94,"column":24}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":94,"column":23},"end":{"row":94,"column":24}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":95,"column":23},"end":{"row":95,"column":24}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":95,"column":23},"end":{"row":95,"column":24}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":146,"column":2},"end":{"row":146,"column":4}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":143,"column":2},"end":{"row":143,"column":4}},"text":"# "},{"action":"removeText","range":{"start":{"row":144,"column":2},"end":{"row":144,"column":4}},"text":"# "},{"action":"removeText","range":{"start":{"row":145,"column":2},"end":{"row":145,"column":4}},"text":"# "}]}]],"redo":[]}},"window":{"width":1440,"height":877,"top":23,"left":0,"isMaximized":true}}